
const USER_COLLECTION_o={LAZY_n:8,ITEMID_e:null,ITEMTAG_e:null,DIALOG_o:{OPEN_s:'<form class="ca_form_inputbox">\n    <label class="ca_form_inputbox_label">',CLOSE_s:"</label></form>",ITEM_DEL_s:"Voulez-vous vraiment supprimer cette image de votre galerie?",GALLERY_DEL_s:"Voulez-vous vraiment supprimer la totalitÃ© des images de cette galerie?"}},userCollectionDescriptionToDOM=e=>{let t=0;for(let l in e)t+=e[l].length;const l=document.getElementById("ca_user_collection_description_list"),_=document.getElementById("ca_user_collection_description_template"),i=document.importNode(_.content,!0),s=i.querySelector("dl#ca_user_collection_description_item"),a=i.querySelector("dt.ca_user_gallery_descriptor"),r=i.querySelector("input#ca_user_gallery_descriptor_input");r.setAttribute("id","ca_user_gallery_description_item_input"),a.appendChild(r);const o=i.querySelector("label.ca_inputbox_label_solo");o.setAttribute("for","ca_user_gallery_descriptor_input");let n=Object.keys(e).length>1?"s":"";o.textContent=`${Object.keys(e).length} galerie${n}`,a.appendChild(o),s.appendChild(a);let c=i.querySelector("dd.ca_user_gallery_descriptor");n=t>1?"s":"",c.textContent=`${t} image${n}`,s.appendChild(c),c=i.getElementById("ca_user_collection_add"),s.appendChild(c),l.appendChild(s)},userCollectionDescriptionEvents=()=>{document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.GALLERY_IDB_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")})},userGalleryDescriptionToDOM=e=>{const t=document.getElementById("ca_user_gallery_description_list"),l=document.getElementById("ca_user_gallery_description_list_template");let _,i,s,a,r,o,n=-1;for(let c in e){++n;let d,g,u=e[c].length,E=e[c][0].tag_s,L=e[c][0].key_n;({now_s:d,locale_s:g}=dateAsLocale__o(L)),(i=(_=document.importNode(l.content,!0)).querySelector("dl#ca_user_gallery_description_item")).setAttribute("id",`ca_user_gallery_description_item_${n}`),s=_.querySelector("dt.ca_user_gallery_descriptor"),i.appendChild(s),(r=_.querySelector("input#ca_user_gallery_description_item_input")).setAttribute("id",`ca_user_gallery_description_item_input_${n}`),s.appendChild(r),(o=_.querySelector("label.ca_inputbox_label_solo")).setAttribute("for",`ca_user_gallery_description_item_input_${n}`),o.setAttribute("data-tag",E),o.textContent=`${E}`,s.appendChild(o),a=_.querySelectorAll("dd.ca_user_gallery_descriptor");let m=u>1?"s":"";a[0].textContent=`${u} image${m}`,i.appendChild(a[0]),a[1].textContent=`${g}`,i.appendChild(a[1]),t.appendChild(i)}},userGalleryDescriptionEvents=()=>{document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.GALLERY_IDB_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}})},userGalleryImgToDOM=e=>{const t=document.querySelector(".ca_gallery_imgs_list");let l,_,i,s,a,r,o,n=document.getElementById("ca_user_gallery_description_template"),c=-1;for(let d in e)++c,o=e[d].item_o,(_=(l=document.importNode(n.content,!0)).querySelector("li#ca_user_gallery_list_item")).setAttribute("id",`ca_user_gallery_list_item_${c}`),_.setAttribute("data-key",e[d].key_n),_.setAttribute("data-file",o.file_s),i=l.querySelector("div.ca_list_imgs_frame"),(s=l.querySelector("img.ca_list_imgs_img")).setAttribute("data-src-width",o.width),s.setAttribute("data-src-height",o.height),s.setAttribute("src",o.src_s),s.setAttribute("loading",c>USER_COLLECTION_o.LAZY_n?"lazy":"auto"),i.appendChild(s),_.appendChild(i),i=l.querySelector("div#ca_user_gallery_list_item_trigger"),_.appendChild(i),a=l.querySelector("ul.ca_list_imgs_legend"),(r=l.querySelector("li.ca_list_imgs_legend_title")).textContent=o.file_s,a.appendChild(r),(r=l.querySelector("li.ca_list_imgs_legend_author")).textContent=o.id_s,a.appendChild(r),(r=l.querySelector("li.ca_list_imgs_legend_collector")).textContent=o.tag_s,a.appendChild(r),_.appendChild(a),t.appendChild(_)},userGalleryImgEvents=()=>{document.getElementById("ca_gallery_imgs_list").addEventListener("click",e=>{const t=e.target;if("svg"!==t.tagName&&"DIV"!==t.tagName)if("IMG"!==t.tagName){if(t.classList.contains("ca_list_imgs_legend_title")){const e=t.closest("li[data-key]");USER_o.GALLERY_IDB_i.set("key_n",Number(e.getAttribute("data-key"))).then(()=>window.location=`${SITE_URL}user/items/2019-05-08-collection_item.html`)}else if(t.classList.contains("ca_list_imgs_legend_author")||t.classList.contains("ca_list_imgs_legend_collector")){const e=t.closest("li[data-key]").getAttribute("data-key"),l=t.closest(".ca_list_imgs_legend");USER_COLLECTION_o.ITEMID_e=l.getElementsByClassName("ca_list_imgs_legend_author")[0];const _=document.getElementById("ca_form_is_user_file_update_id_s");USER_COLLECTION_o.ITEMTAG_e=l.getElementsByClassName("ca_list_imgs_legend_collector")[0];const i=document.getElementById("ca_form_is_user_file_update_tag_s");return _.setAttribute("data-key",e),_.setAttribute("placeholder",USER_COLLECTION_o.ITEMID_e.innerHTML),_.value=USER_COLLECTION_o.ITEMID_e.innerHTML,i.setAttribute("data-key",e),i.setAttribute("placeholder",USER_COLLECTION_o.ITEMTAG_e.innerHTML),i.value=USER_COLLECTION_o.ITEMTAG_e.innerHTML,void contextDialog("user_file_modify",userGalleryItemUpdate)}}else{const e=t.closest("li[data-file]");e&&e.classList.toggle("ca_list_imgs_islarge")}else{const e=t.closest("li[data-key]");userGalleryItemDelete(e.getAttribute("data-key"))}})},usergalleryDelete=e=>{const t=`${USER_COLLECTION_o.DIALOG_o.OPEN_s}${USER_COLLECTION_o.DIALOG_o.GALLERY_DEL_s}${USER_COLLECTION_o.DIALOG_o.CLOSE_s}`;confirmDialog(t,t=>{t&&t.includes("dialog_option_0")&&USER_o.COLLECTION_IDB_i.deleteAll(t=>!e||e===t.tag_s).then(()=>{}).catch(t=>{console.log(`ERROR IDB: delete ${e} failed`)})})},userGalleryItemUpdate=e=>{if(!e||!e.includes("dialog_option_0"))return;const t=document.getElementById("ca_form_is_user_file_update_id_s"),l=Number(t.getAttribute("data-key")),_=t.value,i=document.getElementById("ca_form_is_user_file_update_tag_s"),s=i.value;_!==t.getAttribute("placeholder")&&(USER_o.COLLECTION_IDB_i.update(l,"id_s",_),USER_COLLECTION_o.ITEMID_e.innerHTML=_),s!==i.getAttribute("placeholder")&&(USER_o.COLLECTION_IDB_i.update(l,"tag_s",s),USER_COLLECTION_o.ITEMTAG_e.innerHTML=s)},userGalleryItemDelete=e=>{const t=`${USER_COLLECTION_o.DIALOG_o.OPEN_s}${USER_COLLECTION_o.DIALOG_o.ITEM_DEL_s}${USER_COLLECTION_o.DIALOG_o.CLOSE_s}`;confirmDialog(t,t=>{t&&t.includes("dialog_option_0")&&USER_o.COLLECTION_IDB_i.delete(Number(e)).then(()=>{const t=document.querySelector(`li[data-key="${e}"]`);t&&document.getElementById("ca_gallery_imgs_list").removeChild(t)}).catch(t=>{console.log(`ERROR IDB: delete ${e} failed`)})})},userCollectionGalleriesToDOM=()=>{USER_COLLECTION_o.galleries_a=[],USER_o.COLLECTION_IDB_i.walk((e,t)=>{const{file_s:l,tag_s:_}=t;USER_COLLECTION_o.galleries_a[_]||(USER_COLLECTION_o.galleries_a[_]=[]),USER_COLLECTION_o.galleries_a[_].push({key_n:e,file_s:l,tag_s:_})}).then(()=>{userCollectionDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.GALLERY_IDB_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")}),userGalleryDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.GALLERY_IDB_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}}),USER_o.GALLERY_IDB_i.get("tag_s").then(e=>userGalleryInit(e))})},userGalleryItemsToDOM=e=>{let t=[];USER_o.COLLECTION_IDB_i.walk((l,_)=>{e&&e!==_.tag_s||t.push({key_n:l,item_o:_})}).then(()=>userGalleryImgToDOM(t))},userGalleryInit=e=>{DOMResetNode("ca_gallery_imgs_list"),userGalleryItemsToDOM(e),document.getElementById("ca_gallery_imgs_list").addEventListener("click",e=>{const t=e.target;if("svg"!==t.tagName&&"DIV"!==t.tagName)if("IMG"!==t.tagName){if(t.classList.contains("ca_list_imgs_legend_title")){const e=t.closest("li[data-key]");USER_o.GALLERY_IDB_i.set("key_n",Number(e.getAttribute("data-key"))).then(()=>window.location=`${SITE_URL}user/items/2019-05-08-collection_item.html`)}else if(t.classList.contains("ca_list_imgs_legend_author")||t.classList.contains("ca_list_imgs_legend_collector")){const e=t.closest("li[data-key]").getAttribute("data-key"),l=t.closest(".ca_list_imgs_legend");USER_COLLECTION_o.ITEMID_e=l.getElementsByClassName("ca_list_imgs_legend_author")[0];const _=document.getElementById("ca_form_is_user_file_update_id_s");USER_COLLECTION_o.ITEMTAG_e=l.getElementsByClassName("ca_list_imgs_legend_collector")[0];const i=document.getElementById("ca_form_is_user_file_update_tag_s");return _.setAttribute("data-key",e),_.setAttribute("placeholder",USER_COLLECTION_o.ITEMID_e.innerHTML),_.value=USER_COLLECTION_o.ITEMID_e.innerHTML,i.setAttribute("data-key",e),i.setAttribute("placeholder",USER_COLLECTION_o.ITEMTAG_e.innerHTML),i.value=USER_COLLECTION_o.ITEMTAG_e.innerHTML,void contextDialog("user_file_modify",userGalleryItemUpdate)}}else{const e=t.closest("li[data-file]");e&&e.classList.toggle("ca_list_imgs_islarge")}else{const e=t.closest("li[data-key]");userGalleryItemDelete(e.getAttribute("data-key"))}})};USER_COLLECTION_o.galleries_a=[],USER_o.COLLECTION_IDB_i.walk((e,t)=>{const{file_s:l,tag_s:_}=t;USER_COLLECTION_o.galleries_a[_]||(USER_COLLECTION_o.galleries_a[_]=[]),USER_COLLECTION_o.galleries_a[_].push({key_n:e,file_s:l,tag_s:_})}).then(()=>{userCollectionDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.GALLERY_IDB_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")}),userGalleryDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.GALLERY_IDB_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}}),USER_o.GALLERY_IDB_i.get("tag_s").then(e=>userGalleryInit(e))});

