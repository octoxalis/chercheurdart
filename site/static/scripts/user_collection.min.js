
const USER_COLLECTION_o={lazy_n:8,itemId_e:null,itemTag_e:null,dialogs_o:{open_s:'<form class="ca_filebox_form ca_layout_centered_block">\n    <label class="ca_inputbox_label_solo ca_inputbox_label_text">',close_s:"</label></form>",itemDelete_s:"Voulez-vous vraiment supprimer cette image de votre galerie?",galleryDelete_s:"Voulez-vous vraiment supprimer la totalitÃ© des images de cette galerie?"}},userCollectionDescriptionToDOM=e=>{let t=0;for(let l in e)t+=e[l].length;const l=document.getElementById("ca_user_collection_description_list"),_=document.getElementById("ca_user_collection_description_template"),i=document.importNode(_.content,!0),a=i.querySelector("dl#ca_user_collection_description_item"),s=i.querySelector("dt.ca_user_gallery_descriptor"),o=i.querySelector("input#ca_user_gallery_descriptor_input");o.setAttribute("id","ca_user_gallery_description_item_input"),s.appendChild(o);const r=i.querySelector("label.ca_inputbox_label_solo");r.setAttribute("for","ca_user_gallery_descriptor_input");let n=Object.keys(e).length>1?"s":"";r.textContent=`${Object.keys(e).length} galerie${n}`,s.appendChild(r),a.appendChild(s);let c=i.querySelector("dd.ca_user_gallery_descriptor");n=t>1?"s":"",c.textContent=`${t} image${n}`,a.appendChild(c),c=i.getElementById("ca_user_collection_add"),a.appendChild(c),l.appendChild(a)},userCollectionDescriptionEvents=()=>{document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.galleryIdb_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")})},userGalleryDescriptionToDOM=e=>{const t=document.getElementById("ca_user_gallery_description_list"),l=document.getElementById("ca_user_gallery_description_list_template");let _,i,a,s,o,r,n=-1;for(let c in e){++n;let d,g,u=e[c].length,m=e[c][0].tag_s,y=e[c][0].key_n;({now_s:d,locale_s:g}=dateAsLocale__o(y)),(i=(_=document.importNode(l.content,!0)).querySelector("dl#ca_user_gallery_description_item")).setAttribute("id",`ca_user_gallery_description_item_${n}`),a=_.querySelector("dt.ca_user_gallery_descriptor"),i.appendChild(a),(o=_.querySelector("input#ca_user_gallery_description_item_input")).setAttribute("id",`ca_user_gallery_description_item_input_${n}`),a.appendChild(o),(r=_.querySelector("label.ca_inputbox_label_solo")).setAttribute("for",`ca_user_gallery_description_item_input_${n}`),r.setAttribute("data-tag",m),r.textContent=`${m}`,a.appendChild(r),s=_.querySelectorAll("dd.ca_user_gallery_descriptor");let p=u>1?"s":"";s[0].textContent=`${u} image${p}`,i.appendChild(s[0]),s[1].textContent=`${g}`,i.appendChild(s[1]),t.appendChild(i)}},userGalleryDescriptionEvents=()=>{document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.galleryIdb_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}})},userGalleryImgToDOM=e=>{const t=document.querySelector(".ca_gallery_imgs_list");let l,_,i,a,s,o,r,n=document.getElementById("ca_user_gallery_description_template"),c=-1;for(let d in e)++c,r=e[d].item_o,(_=(l=document.importNode(n.content,!0)).querySelector("li#ca_user_gallery_list_item")).setAttribute("id",`ca_user_gallery_list_item_${c}`),_.setAttribute("data-key",e[d].key_n),_.setAttribute("data-file",r.file_s),i=l.querySelector("div.ca_list_imgs_frame"),(a=l.querySelector("img.ca_list_imgs_img")).setAttribute("data-src-width",r.width),a.setAttribute("data-src-height",r.height),a.setAttribute("src",r.src_s),a.setAttribute("loading",c>USER_COLLECTION_o.lazy_n?"lazy":"auto"),i.appendChild(a),_.appendChild(i),i=l.querySelector("div#ca_user_gallery_list_item_trigger"),_.appendChild(i),s=l.querySelector("ul.ca_list_imgs_legend"),(o=l.querySelector("li.ca_list_imgs_legend_title")).textContent=r.file_s,s.appendChild(o),(o=l.querySelector("li.ca_list_imgs_legend_author")).textContent=r.id_s,s.appendChild(o),(o=l.querySelector("li.ca_list_imgs_legend_collector")).textContent=r.tag_s,s.appendChild(o),_.appendChild(s),t.appendChild(_)},userGalleryImgEvents=()=>{document.getElementById("ca_gallery_imgs_list").addEventListener("click",e=>{const t=e.target;if("svg"!==t.tagName&&"DIV"!==t.tagName)if("IMG"!==t.tagName){if(t.classList.contains("ca_list_imgs_legend_title")){const e=t.closest("li[data-key]");USER_o.galleryIdb_i.set("key_n",Number(e.getAttribute("data-key"))).then(()=>window.location=`${SITE_ROOT_URL}user/items/2019-05-08-collection_item.html`)}else if(t.classList.contains("ca_list_imgs_legend_author")||t.classList.contains("ca_list_imgs_legend_collector")){const e=t.closest("li[data-key]").getAttribute("data-key"),l=t.closest(".ca_list_imgs_legend");USER_COLLECTION_o.itemId_e=l.getElementsByClassName("ca_list_imgs_legend_author")[0];const _=document.getElementById("ca_form_input_is_user_file_update_id");USER_COLLECTION_o.itemTag_e=l.getElementsByClassName("ca_list_imgs_legend_collector")[0];const i=document.getElementById("ca_form_input_is_user_file_update_tag");return _.setAttribute("data-key",e),_.setAttribute("placeholder",USER_COLLECTION_o.itemId_e.innerHTML),_.value=USER_COLLECTION_o.itemId_e.innerHTML,i.setAttribute("data-key",e),i.setAttribute("placeholder",USER_COLLECTION_o.itemTag_e.innerHTML),i.value=USER_COLLECTION_o.itemTag_e.innerHTML,void contextDialog("user_file_modify",userGalleryItemUpdate)}}else{const e=t.closest("li[data-file]");e&&e.classList.toggle("ca_list_imgs_islarge")}else{const e=t.closest("li[data-key]");userGalleryItemDelete(e.getAttribute("data-key"))}})},usergalleryDelete=e=>{const t=`${USER_COLLECTION_o.dialogs_o.open_s}${USER_COLLECTION_o.dialogs_o.galleryDelete_s}${USER_COLLECTION_o.dialogs_o.close_s}`;confirmDialog(t,t=>{t&&t.includes("dialog_option_0")&&USER_o.collectionIdb_i.deleteAll(t=>!e||e===t.tag_s).then(()=>{}).catch(t=>{console.log(`ERROR IDB: delete ${e} failed`)})})},userGalleryItemUpdate=e=>{if(!e||!e.includes("dialog_option_0"))return;const t=document.getElementById("ca_form_input_is_user_file_update_id"),l=Number(t.getAttribute("data-key")),_=t.value,i=document.getElementById("ca_form_input_is_user_file_update_tag"),a=i.value;_!==t.getAttribute("placeholder")&&(USER_o.collectionIdb_i.update(l,"id_s",_),USER_COLLECTION_o.itemId_e.innerHTML=_),a!==i.getAttribute("placeholder")&&(USER_o.collectionIdb_i.update(l,"tag_s",a),USER_COLLECTION_o.itemTag_e.innerHTML=a)},userGalleryItemDelete=e=>{const t=`${USER_COLLECTION_o.dialogs_o.open_s}${USER_COLLECTION_o.dialogs_o.itemDelete_s}${USER_COLLECTION_o.dialogs_o.close_s}`;confirmDialog(t,t=>{t&&t.includes("dialog_option_0")&&USER_o.collectionIdb_i.delete(Number(e)).then(()=>{const t=document.querySelector(`li[data-key="${e}"]`);t&&document.getElementById("ca_gallery_imgs_list").removeChild(t)}).catch(t=>{console.log(`ERROR IDB: delete ${e} failed`)})})},userCollectionGalleriesToDOM=()=>{USER_COLLECTION_o.galleries_a=[],USER_o.collectionIdb_i.walk((e,t)=>{const{file_s:l,tag_s:_}=t;USER_COLLECTION_o.galleries_a[_]||(USER_COLLECTION_o.galleries_a[_]=[]),USER_COLLECTION_o.galleries_a[_].push({key_n:e,file_s:l,tag_s:_})}).then(()=>{userCollectionDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.galleryIdb_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")}),userGalleryDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.galleryIdb_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}}),USER_o.galleryIdb_i.get("tag_s").then(e=>userGalleryInit(e))})},userGalleryItemsToDOM=e=>{let t=[];USER_o.collectionIdb_i.walk((l,_)=>{e&&e!==_.tag_s||t.push({key_n:l,item_o:_})}).then(()=>userGalleryImgToDOM(t))},userGalleryInit=e=>{DOMResetNode("ca_gallery_imgs_list"),userGalleryItemsToDOM(e),document.getElementById("ca_gallery_imgs_list").addEventListener("click",e=>{const t=e.target;if("svg"!==t.tagName&&"DIV"!==t.tagName)if("IMG"!==t.tagName){if(t.classList.contains("ca_list_imgs_legend_title")){const e=t.closest("li[data-key]");USER_o.galleryIdb_i.set("key_n",Number(e.getAttribute("data-key"))).then(()=>window.location=`${SITE_ROOT_URL}user/items/2019-05-08-collection_item.html`)}else if(t.classList.contains("ca_list_imgs_legend_author")||t.classList.contains("ca_list_imgs_legend_collector")){const e=t.closest("li[data-key]").getAttribute("data-key"),l=t.closest(".ca_list_imgs_legend");USER_COLLECTION_o.itemId_e=l.getElementsByClassName("ca_list_imgs_legend_author")[0];const _=document.getElementById("ca_form_input_is_user_file_update_id");USER_COLLECTION_o.itemTag_e=l.getElementsByClassName("ca_list_imgs_legend_collector")[0];const i=document.getElementById("ca_form_input_is_user_file_update_tag");return _.setAttribute("data-key",e),_.setAttribute("placeholder",USER_COLLECTION_o.itemId_e.innerHTML),_.value=USER_COLLECTION_o.itemId_e.innerHTML,i.setAttribute("data-key",e),i.setAttribute("placeholder",USER_COLLECTION_o.itemTag_e.innerHTML),i.value=USER_COLLECTION_o.itemTag_e.innerHTML,void contextDialog("user_file_modify",userGalleryItemUpdate)}}else{const e=t.closest("li[data-file]");e&&e.classList.toggle("ca_list_imgs_islarge")}else{const e=t.closest("li[data-key]");userGalleryItemDelete(e.getAttribute("data-key"))}})};window.onload=(()=>(USER_COLLECTION_o.galleries_a=[],void USER_o.collectionIdb_i.walk((e,t)=>{const{file_s:l,tag_s:_}=t;USER_COLLECTION_o.galleries_a[_]||(USER_COLLECTION_o.galleries_a[_]=[]),USER_COLLECTION_o.galleries_a[_].push({key_n:e,file_s:l,tag_s:_})}).then(()=>{userCollectionDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_collection_description_list").parentElement.addEventListener("click",e=>{const t=e.target;if("ca_user_gallery_descriptor_label"===t.id){const e=null;return USER_o.galleryIdb_i.set("tag_s",e),userGalleryInit(e),void AreaSwap("text","gallery")}("ca_user_collection_add_label"===t.id||t.classList.contains("ca_svg_icon"))&&contextDialog("user_file")}),userGalleryDescriptionToDOM(USER_COLLECTION_o.galleries_a),document.getElementById("ca_user_gallery_description_list").parentElement.addEventListener("click",e=>{if("LABEL"===e.target.tagName){const t=e.target.getAttribute("data-tag");USER_o.galleryIdb_i.set("tag_s",t),userGalleryInit(t),AreaSwap("text","gallery")}}),USER_o.galleryIdb_i.get("tag_s").then(e=>userGalleryInit(e))})));

