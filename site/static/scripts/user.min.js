
const CA_user_o={img_o:null,collectionIdb_i:null,galleryIdb_i:null,notecyrb53_n:0,dialogs_o:{format:"Le fichier sélectionné n'est pas au format JPEG",size:"La taille de l'image est trop grande: impossible de l'analyser",reader:"Une erreur s'est produite en chargeant le fichier image: impossible de l'analyser"}},userImgGetInfo=()=>{return{id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value}},userImgToDataUrl=e=>{if(!e.files.length)return;const t=e=>document.getElementById("ca_form_img_label_is_user_file").innerHTML=e||"",_=e.files[0];if(!_.type.match("image/jpeg"))return t(CA_user_o.dialogs_o.format),void(document.getElementById("ca_form_img_thumb_is_user_file").src="");const o=new FileReader;o.onerror=(e=>(o.abort(),t(CA_user_o.dialogs_o.reader))),o.onload=(e=>{const o=DOM_getRootVar("--MEDIA_USER_IMG_DIM_MAX"),n=new Image;n.onload=(s=>{const l=s.target.naturalWidth,i=s.target.naturalHeight;let r="",c=_.name;l*i>o*o?c=CA_user_o.dialogs_o.size:r=n.src,t(c),""!==r&&(document.getElementById("ca_form_img_thumb_is_user_file").src=r,CA_user_o.img_o={file_s:_.name,id_s:"",tag_s:"",note_s:"",width:l,height:i,src_s:e.target.result})}),n.src=e.target.result}),o.readAsDataURL(_)},userImgFileToIDB=e=>{if(!e||!e.includes("dialog_option_0"))return;const t={id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value};CA_user_o.img_o.id_s=t.id_s,CA_user_o.img_o.tag_s=t.tag_s||"collection";const _=Date.now();CA_user_o.collectionIdb_i.set(_,CA_user_o.img_o).then(()=>window.location.reload())},userImgInit=e=>{CA_user_o.galleryIdb_i.get("key_n").then(t=>{CA_user_o.collectionIdb_i.get(t).then(t=>{if(t){const _=new Image(t.width,t.height);_.src=t.src_s,_.onload=(o=>e(_,Object.assign({},t,{src_s:void 0})))}})}),userImgNoteEvents()},userImgNoteEvents=()=>{const e=document.getElementById("ca_user_collection_note_icons"),t=document.getElementById("ca_user_collection_note_edit"),_=document.getElementById("ca_user_collection_note_publish");e.addEventListener("click",e=>{const o=e.target.closest("svg");"ca_user_collection_note_icon_edit"===o.id&&(CA_user_o.notecyrb53_n=cyrb53(t.value)),"ca_user_collection_note_icon_publish"===o.id&&CA_user_o.notecyrb53_n!==cyrb53(t.value)&&(_.innerHTML=marked(t.value),CA_user_o.galleryIdb_i.get("key_n").then(e=>CA_user_o.collectionIdb_i.update(e,"note_s",t.value))),_.classList.toggle("ca_user_collection_note_hide"),document.getElementById("ca_user_collection_note_icon_edit").classList.toggle("ca_user_collection_note_hide")})};null===CA_user_o.collectionIdb_i&&(CA_user_o.collectionIdb_i=new KVIdb("UserCollection","collection")),null===CA_user_o.galleryIdb_i&&(CA_user_o.galleryIdb_i=new KVIdb("UserGallery","gallery"));

