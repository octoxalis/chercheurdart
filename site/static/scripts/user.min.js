
const CA_user_o={img_o:null,collectionIdb_i:null,galleryIdb_i:null,dialogs_o:{format:"Le fichier sélectionné n'est pas au format JPEG",size:"La taille de l'image est trop grande: impossible de l'analyser",reader:"Une erreur s'est produite en chargeant le fichier image: impossible de l'analyser"}},userImgGetInfo=()=>{return{id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value}},userImgToDataUrl=e=>{if(!e.files.length)return;const t=e=>document.getElementById("ca_form_img_label_is_user_file").innerHTML=e||"",_=e.files[0];if(!_.type.match("image/jpeg"))return t(CA_user_o.dialogs_o.format),void(document.getElementById("ca_form_img_thumb_is_user_file").src="");const o=new FileReader;o.onerror=(e=>(o.abort(),t(CA_user_o.dialogs_o.reader))),o.onload=(e=>{const o=DOM_getRootVar("--MEDIA_USER_IMG_DIM_MAX"),i=new Image;i.onload=(r=>{const s=r.target.naturalWidth,l=r.target.naturalHeight;let n="",a=_.name;s*l>o*o?a=CA_user_o.dialogs_o.size:n=i.src,t(a),""!==n&&(document.getElementById("ca_form_img_thumb_is_user_file").src=n,CA_user_o.img_o={file_s:_.name,id_s:"",tag_s:"",note_s:"",width:s,height:l,src_s:e.target.result})}),i.src=e.target.result}),o.readAsDataURL(_)},userImgFileToIDB=e=>{if(!e||!e.includes("dialog_option_0"))return;const t={id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value};CA_user_o.img_o.id_s=t.id_s,CA_user_o.img_o.tag_s=t.tag_s||"collection";const _=Date.now();CA_user_o.collectionIdb_i.set(_,CA_user_o.img_o).then(()=>window.location.reload())},userImgInit=e=>{CA_user_o.galleryIdb_i.get("item").then(t=>{CA_user_o.collectionIdb_i.get(t).then(t=>{if(t){const _=new Image(t.width,t.height);_.src=t.src_s;const o={file_s:t.file_s,width:t.width,height:t.height};_.onload=(t=>e(_,o))}})})};null===CA_user_o.collectionIdb_i&&(CA_user_o.collectionIdb_i=new KVIdb("UserCollection","collection")),null===CA_user_o.galleryIdb_i&&(CA_user_o.galleryIdb_i=new KVIdb("UserGallery","gallery"));

