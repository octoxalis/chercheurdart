
const USER_o={img_o:null,collectionIdb_i:null,galleryIdb_i:null,notecyrb53_n:0,dialogs_o:{format_s:"Le fichier sélectionné n'est pas au format JPEG",size_s:"La taille de l'image est trop grande: impossible de l'analyser",reader_s:"Une erreur s'est produite en chargeant le fichier image: impossible de l'analyser"}},userImgGetInfo_o=()=>{return{id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value}},userImgToDataUrl=e=>{if(!e.files.length)return;const t=e=>document.getElementById("ca_form_img_label_is_user_file").innerHTML=e||"",_=e.files[0];if(!_.type.match("image/jpeg"))return t(USER_o.dialogs_o.format_s),void(document.getElementById("ca_form_img_thumb_is_user_file").src="");const o=new FileReader;o.onerror=(e=>(o.abort(),t(USER_o.dialogs_o.reader_s))),o.onload=(e=>{const o=DOMRootVar__s("--MEDIA_USER_IMG_DIM_MAX"),n=new Image;n.onload=(l=>{const i=l.target.naturalWidth,s=l.target.naturalHeight;let c="",r=_.name;i*s>o*o?r=USER_o.dialogs_o.size_s:c=n.src,t(r),""!==c&&(document.getElementById("ca_form_img_thumb_is_user_file").src=c,USER_o.img_o={file_s:_.name,id_s:"",tag_s:"",note_s:"",width:i,height:s,src_s:e.target.result})}),n.src=e.target.result}),o.readAsDataURL(_)},userImgFileToIDB=e=>{if(!e||!e.includes("dialog_option_0"))return;const t={id_s:document.getElementById("ca_form_input_is_user_id").value,tag_s:document.getElementById("ca_form_input_is_user_tag").value};USER_o.img_o.id_s=t.id_s,USER_o.img_o.tag_s=t.tag_s||"collection";const _=Date.now();USER_o.collectionIdb_i.set(_,USER_o.img_o).then(()=>window.location.reload())},userImgInit=e=>{USER_o.galleryIdb_i.get("key_n").then(t=>{USER_o.collectionIdb_i.get(t).then(t=>{if(t){const _=new Image(t.width,t.height);_.src=t.src_s,_.onload=(o=>e(_,Object.assign({},t,{src_s:void 0})))}})}),userImgNoteEvents()},userImgNoteEvents=()=>{const e=document.getElementById("ca_user_collection_note_icons"),t=document.getElementById("ca_user_collection_note_edit"),_=document.getElementById("ca_user_collection_note_publish");e.addEventListener("click",e=>{const o=e.target.closest("svg");"ca_user_collection_note_icon_edit"===o.id&&(USER_o.notecyrb53_n=cyrb53__n(t.value)),"ca_user_collection_note_icon_publish"===o.id&&USER_o.notecyrb53_n!==cyrb53__n(t.value)&&(_.innerHTML=marked(t.value),USER_o.galleryIdb_i.get("key_n").then(e=>USER_o.collectionIdb_i.update(e,"note_s",t.value))),_.classList.toggle("ca_user_collection_note_hide"),document.getElementById("ca_user_collection_note_icon_edit").classList.toggle("ca_user_collection_note_hide")})};null===USER_o.collectionIdb_i&&(USER_o.collectionIdb_i=new KVIdb("UserCollection","collection")),null===USER_o.galleryIdb_i&&(USER_o.galleryIdb_i=new KVIdb("UserGallery","gallery"));

