
const USER_o={img_o:null,collectionIdb_i:null,galleryIdb_i:null,notecyrb53_n:0,dialogs_o:{format_s:"Le fichier sélectionné n'est pas au format JPEG",size_s:"La taille de l'image est trop grande: impossible de l'analyser",reader_s:"Une erreur s'est produite en chargeant le fichier image: impossible de l'analyser"}},userImgGetInfo_o=()=>{return{id_s:document.getElementById("ca_form_is_user_file_setup_id_s").value,tag_s:document.getElementById("ca_form_is_user_file_setup_tag_s").value}},userImgToDataUrl=e=>{if(!e.files.length)return;const _=e=>document.getElementById("ca_form_is_user_file_setup_id_s").innerHTML=e||"",t=e.files[0];if(!t.type.match("image/jpeg"))return _(USER_o.dialogs_o.format_s),void(document.getElementById("ca_form_is_user_file_img_thumb").src="");const o=new FileReader;o.onerror=(e=>(o.abort(),_(USER_o.dialogs_o.reader_s))),o.onload=(e=>{const o=DOMRootVar__s("--MEDIA_USER_IMG_DIM_MAX"),l=new Image;l.onload=(n=>{const s=n.target.naturalWidth,i=n.target.naturalHeight;let c="",r=t.name;s*i>o*o?r=USER_o.dialogs_o.size_s:c=l.src,_(r),""!==c&&(document.getElementById("ca_form_is_user_file_img_thumb").src=c,USER_o.img_o={file_s:t.name,id_s:"",tag_s:"",note_s:"",width:s,height:i,src_s:e.target.result})}),l.src=e.target.result}),o.readAsDataURL(t)},userImgFileToIDB=e=>{if(!e||!e.includes("dialog_option_0"))return;const _={id_s:document.getElementById("ca_form_is_user_file_setup_id_s").value,tag_s:document.getElementById("ca_form_is_user_file_setup_tag_s").value};USER_o.img_o.id_s=_.id_s,USER_o.img_o.tag_s=_.tag_s||"collection";const t=Date.now();USER_o.collectionIdb_i.set(t,USER_o.img_o).then(()=>window.location.reload())},userImgInit=e=>{USER_o.galleryIdb_i.get("key_n").then(_=>{USER_o.collectionIdb_i.get(_).then(_=>{if(_){const t=new Image(_.width,_.height);t.src=_.src_s,t.onload=(o=>e(t,Object.assign({},_,{src_s:void 0})))}})}),userImgNoteEvents()},userImgNoteEvents=()=>{const e=document.getElementById("ca_user_collection_note_icons"),_=document.getElementById("ca_user_collection_note_edit"),t=document.getElementById("ca_user_collection_note_publish");e.addEventListener("click",e=>{const o=e.target.closest("svg");"ca_user_collection_note_icon_edit"===o.id&&(USER_o.notecyrb53_n=cyrb53__i(_.value)),"ca_user_collection_note_icon_publish"===o.id&&USER_o.notecyrb53_n!==cyrb53__i(_.value)&&(t.innerHTML=marked(_.value),USER_o.galleryIdb_i.get("key_n").then(e=>USER_o.collectionIdb_i.update(e,"note_s",_.value))),t.classList.toggle("ca_user_collection_note_hide"),document.getElementById("ca_user_collection_note_icon_edit").classList.toggle("ca_user_collection_note_hide")})};null===USER_o.collectionIdb_i&&(USER_o.collectionIdb_i=new KVIdb("UserCollection","collection")),null===USER_o.galleryIdb_i&&(USER_o.galleryIdb_i=new KVIdb("UserGallery","gallery"));

