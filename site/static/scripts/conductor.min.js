
class Conductor{constructor(t){this.prefix_s=t.prefix_s||"ca_conductor",this.navicon_s=t.navicon_s||"ca_svg_icon",this.conductorWidth_n=t.width_n||500,this.template_e=document.getElementById(`ca_conductor_steps_${t.file_s}`),this.content_e=document.importNode(this.template_e.content,!0),this.steps_n=this.content_e.querySelectorAll("li[data-step]").length,this.at_n=-1,this.callbacks_a=[],this.setNavEvents()}setNavEvents(){document.querySelector(`.${this.prefix_s}_nav`).addEventListener("click",t=>{const e=t.target;if(e){const t=e.closest("div").getAttribute("data-event");t&&this[t]()}})}init(t){const e=t.getAttribute("data-target"),s=document.querySelector(e).getBoundingClientRect();this.top_n=s.top,this.left_n=s.left,this.width_n=s.width,this.height_n=s.height;const i=t.getAttribute("data-clip");if(i){const[t,s,n,o]=i.split(" "),c=document.querySelector(e).getAttribute("data-src-width"),_=this.width_n/c;this.top_n+=_*t,this.left_n+=_*s,this.width_n=_*n,this.offset=.5*this.width_n,this.height_n=_*o}return this.setOverlay(),this}setOverlay(){const t=document.querySelector(`.${this.prefix_s}_overlay`);t.classList.remove("ca_unseen");const e=t.style;e.top=`${this.top_n}px`,e.left=`${this.left_n}px`,e.width=`${this.width_n}px`,e.height=`${this.height_n}px`}setConductor(t){let e,s;return document.querySelector(`.${this.prefix_s}_content`).classList.remove("ca_unseen"),DOMRootVar("--CONDUCTOR_WIDTH",t),DOMRootVar("--CONDUCTOR_TOP",this.top_n+this.height_n),window.innerWidth-this.left_n>t?(e=this.left_n,this.offset&&(e+=this.offset),s=0):(e=this.left_n-(t-this.width_n),this.offset&&(e-=this.offset),s=97),DOMRootVar("--CONDUCTOR_LEFT",e),DOMRootVar("--CONDUCTOR_ARROW_LEFT",s),this}setContent(){let t=this.content_e.cloneNode(!0);const e=t.querySelector(`li[data-step="${this.at_n}"] > div`);DOMResetNode(`${this.prefix_s}_title`).appendChild(e);const s=t.querySelector(`li[data-step="${this.at_n}"] > div`);return DOMResetNode(`${this.prefix_s}_description`).appendChild(s),this}open(){let t=this.content_e.cloneNode(!0);const e=t.querySelector(`li[data-step="${this.at_n}"]`),s=t.querySelector(`li[data-step="${this.at_n}"] > div[data-callback="true"]`);s&&!1===this.callbacks_a.includes(this.at_n)&&(this.callback(s),s.hasAttribute("data-callback-once")&&this.callbacks_a.push(this.at_n)),this.init(e).setContent().setConductor(e.getAttribute("data-width")||this.conductorWidth_n)}callback(t){const e=t.textContent.trimStart().trimEnd();new Function(e)()}close(){["overlay","content","nav_previous","nav_next"].forEach(t=>{document.querySelector(`.${this.prefix_s}_${t}`).classList.add("ca_unseen")}),this.at_n=-1}previous(){this.at_n--,0===this.at_n?(document.querySelector(`.${this.prefix_s}_nav_previous`).classList.add("ca_unseen"),this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen")):this.at_n===this.steps_n-2&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),this.open()}next(){this.at_n!==this.steps_n-1&&(this.at_n++,this.at_n===this.steps_n-1?this.steps_n>1&&(document.querySelector(`.${this.prefix_s}_nav_next`).classList.add("ca_unseen"),document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")):(0===this.at_n&&this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),1===this.at_n&&document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")),this.open())}step__n(){return this.at_n}}

