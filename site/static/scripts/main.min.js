
class KVIdb{constructor(e="kv_db",t="kv_store",s=1){this.idb=null,this.idb_s=e,this.store=t,this.version=s,this.ready=null,this.init()}init(){this.ready=new Promise((e,t)=>{const s=window.indexedDB.open(this.idb_s,this.version);s.onupgradeneeded=(e=>{this.idb=e.target.result,this.idb.createObjectStore(this.store)}),s.onsuccess=(t=>{this.idb=t.target.result,e(t.target.result)}),s.onerror=(e=>t(e.target.error))})}get(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).get(e);o.onsuccess=(e=>t(e.target.result)),o.onerror=s}))}walk(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor();o.onsuccess=(s=>{let o=s.target.result;o?(e(o.key,o.value),o.continue()):t()}),o.onerror=s}))}last(){return this.ready.then(()=>new Promise((e,t)=>{const s=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor(null,"prev");s.onsuccess=(t=>{t.target.result&&e(t.target.result.value)}),s.onerror=t}))}set(e,t){return this.ready.then(()=>new Promise((s,o)=>{const r=this.idb.transaction([this.store],"readwrite").objectStore(this.store).put(t,e);r.onsuccess=s,r.onerror=o}))}update(e,t,s){return this.ready.then(()=>new Promise((o,r)=>{const a=this.idb.transaction([this.store],"readwrite").objectStore(this.store),n=a.get(e);n.onsuccess=(()=>{const i=n.result;i[t]=s;const l=a.put(i,e);l.onsuccess=o,l.onerror=r}),n.onerror=r}))}deleteAll(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store),r=o.openCursor();r.onsuccess=(t=>{let s,r=t.target.result;r&&(s=r.value,e(s)&&o.delete(r.key),r.continue())}),r.onerror=s}))}delete(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store).delete(e);o.onsuccess=t,o.onerror=s}))}clear(){return this.ready.then(()=>new Promise((e,t)=>{const s=this.idb.transaction([this.store],"readwrite").objectStore(this.store).clear();s.onsuccess=e,s.onerror=t}))}deleteIDB(){window.indexedDB.deleteDatabase(this.idb_s)}}const MAIN_o={math:{pi2_n:2*Math.PI,radDeg_n:180/Math.PI}},A_unshift=(e,t)=>{let s=e.length;for(;s;)e[s]=e[s-1],--s;e[0]=t},A_splice=(e,t)=>{let s=e.length;if(s){for(;t<s;)e[t]=e[t+1],++t;--e.length}},A_indexOf__i=(e,t)=>{for(let s=0,o=e.length;s!=o;s++)if(e[s]===t)return s;return-1},A_lastIndexOf__i=(e,t)=>{let s=e.length;for(;s--&&e[s]!==t;);return s},A_fill__a=(e,t)=>{const s=new Array(e);for(;--e>=0;)s[e]=t;return s},dateAsLocale__o=(e=null)=>{let t=e?new Date(e):new Date;const s=t.getFullYear(),o=t.getMonth()+1,r=o<10?`0${o}`:`${o}`,a=t.getDate();return{now_s:`${s}-${r}-${a<10?`0${a}`:`${a}`}`,locale_s:t.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}},cyrb53__i=(e,t=0)=>{let s,o=3735928559^t,r=1103547991^t;for(let t=0;t<e.length;++t)s=e.charCodeAt(t),o=Math.imul(o^s,2654435761),r=Math.imul(r^s,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&(r=Math.imul(r^r>>>16,2246822507)^Math.imul(o^o>>>13,3266489909)))+(o>>>0)},DOMloadAsset=(e,t,s)=>{const o=document.getElementById(t);if(null===o)return;const r=e.substring(e.lastIndexOf(".")+1,e.length);if(""===r)return;let a;switch(r){case"js":(a=document.createElement("script")).src=e,a.async=!0;break;case"css":(a=document.createElement("link")).href=e,a.rel="stylesheet";break;default:return}s&&(a.onload=s),o.after(a)},DOMRootVar=(e,t)=>{document.documentElement.style.setProperty(e,t)},DOMRootVar__s=e=>getComputedStyle(document.documentElement).getPropertyValue(e)||"",DOMResetNode=e=>{const t=document.getElementById(e);for(;t.firstChild;)t.removeChild(t.firstChild)},DOMStyle__s=(e,t)=>{let s=document.getElementById(e);return s?window.getComputedStyle(s).getPropertyValue(t):""},DOMImgDim__o=e=>{const t=document.getElementById(e);return{width:t.getAttribute("data-src-width"),height:t.getAttribute("data-src-height")}},DOMStrimHTML__s=e=>e.replace(/(<([^>]+)>)/gi,""),DOMOpenFolder=e=>{e.nextElementSibling.classList.toggle("ca_is_open"),e.parentElement.classList.toggle("ca_has_open")},DOMOpenFolderAll=()=>{const e=document.getElementById("ca_folder_opener"),t=e.classList.contains("_ca_folder_opener_");e.classList.toggle("_ca_folder_opener_");const s=document.getElementById("ca_folder_container_inner").querySelectorAll(".ca_fold_content");let o;for(let e of s)if(t){e.classList.remove("ca_has_open"),o=e.querySelectorAll(".ca_fold_content_item");for(let e of o)e.classList.remove("ca_is_open")}else{e.classList.add("ca_has_open"),o=e.querySelectorAll(".ca_fold_content_item");for(let e of o)e.classList.add("ca_is_open")}},DOMDialog=(e,t)=>{const s=e.type_s;if(dialog_e=document.getElementById(`ca_dialog_is_${s}`),t||"function"!=typeof dialog_e.showModal){const t=e.mark_s?DOMStrimHTML__s(e.mark_s):"";return void window.alert(`${e.header_s||""}: ${e.content_s||""} (${t})`)}if(e.header_s&&(document.getElementById(`ca_dialog_header_is_${s}`).innerHTML=e.header_s),e.content_s&&(document.getElementById(`ca_dialog_content_is_${s}`).innerHTML=e.content_s+(e.mark_s?e.mark_s:"")),void 0===e.options_a){const e=document.getElementById(`ca_dialog_options_is_${s}`);e&&e.classList.add("ca_dialog_option_hidden")}else{options_e=document.getElementById(`ca_dialog_options_is_${s}`),options_e.classList.remove("ca_dialog_option_hidden");const t=options_e.querySelectorAll("li");for(let s=0;s<t.length;++s){const o=t[s].classList.contains("ca_dialog_option_hidden");e.options_a[s]?(t[s].innerHTML=e.options_a[s],t[s].classList.remove("ca_dialog_option_hidden"),t[s].addEventListener("click",()=>{e.result=t[s].id,e.callback_f&&e.callback_f(e.result),dialog_e.close(e.result)})):o||t[s].classList.add("ca_dialog_option_hidden")}}const o=e.cancel||"cancelled";document.getElementById(`ca_dialog_close_is_${s}`).addEventListener("click",()=>{console.log(`type_s: ${e.type_s}`),dialog_e.close(o)}),dialog_e.addEventListener("click",e=>{e.target===dialog_e&&dialog_e.close(o)}),dialog_e.addEventListener("close",t=>{e.result=dialog_e.returnValue}),dialog_e.showModal()},DOMToClipboard=e=>{const t=()=>{e.mark_s+=" impossible",DOMDialog(e,!0)};navigator.permissions.query({name:"clipboard-write"}).then(s=>{"granted"!=s.state&&"prompt"!=s.state||navigator.clipboard.writeText(e.content_s).then(()=>{DOMDialog(e)},()=>{t()})}).catch(()=>{t()})},mailtoDialog__s=e=>{const t={type_s:"note",header_s:"Adresse pour contacter l'auteur",content_s:((e,t)=>{const s=e=>String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26);return`${e.replace(/[a-zA-Z]/g,s)}@${t.replace(/[a-zA-Z]/g,s)}`})("nqhcva","purepurheq.neg"),mark_s:"<p><mark>copie dans le presse-papier</mark></p>"};DOMToClipboard(t)},confirmDialog=(e,t)=>{DOMDialog({type_s:"confirm",content_s:e,options_a:["Je renonce","Je confirme"],callback_f:t})},statusDialog=()=>{DOMDialog({type_s:"status"})},searchTagsDialog=()=>{DOMDialog({type_s:"search"})},contextDialog=e=>{const t={type_s:e};"user_file"===e&&(t.options_a=["Abandonner","Analyser"],t.callback_f=userImgFileToIDB),"user_file_modify"===e&&(t.options_a=["Abandonner","Modifier"],t.callback_f=userGalleryItemUpdate),DOMDialog(t)};class DragElement{constructor(e,t){this.gapX=0,this.gapY=0,this.offsetX=0,this.offsetY=0,this.atX=0,this.atY=0,this.drag_e=e,this.keep_b=t||!1,this.start()}start(){this.drag_e.onmousedown=(e=>(this.loose_b=!1,this.gapX=e.clientX-this.offsetX,this.gapY=e.clientY-this.offsetY,this.drag_e.addEventListener("mousemove",this,!1),this.drag_e.addEventListener("mouseup",this,!1),!1))}disable(){this.loose_b=!0}handleEvent(e){return!this.loose_b&&("mousemove"===e.type?(this.atX=e.clientX-this.gapX,this.atY=e.clientY-this.gapY,this.offsetX=this.atX,this.offsetY=this.atY,this.drag_e.style.transform=`translate3d(${this.atX}px, ${this.atY}px, 0)`,!1):void("mouseup"===e.type&&(this.keep_b||(this.drag_e.removeEventListener("mousemove",this,!0),this.drag_e.removeEventListener("mouseup",this,!0)),this.loose_b=!0)))}}const RGB_H__i=(e,t,s)=>{const o=Math.min(e,t,s),r=Math.max(e,t,s);if(r===o)return 0;const a=r-o,n=r===e?(t-s)/a+(t<s?6:0):r===t?(s-e)/a+2:(e-t)/a+4;return Math.floor(60*n)},RGB_S__i=(e,t,s)=>{const o=Math.min(e,t,s),r=Math.max(e,t,s),a=r-o;if(!a)return 0;const n=o+r;return n>255?a/(510-r-o):a/n},RGB_L__i=(e,t,s)=>(Math.min(e,t,s)+Math.max(e,t,s))/510,HSL_RGB__o=(e,t,s)=>{let o,r,a;if(0===t)o=r=a=s;else{const n=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<.1666667?e+6*(t-e)*s:s<.5?t:s<.6666667?e+(t-e)*(.6666667-s)*6:e),i=s<.5?s*(1+t):s+t-s*t,l=2*s-i;o=n(l,i,(e/=360)+.3333334),r=n(l,i,e),a=n(l,i,e-.3333334)}return[o,r,a]},HueMatrix__s=e=>{let t,s,o,r=DOMRootVar__s("--M3_FE_MATRIX");return e<0?t=s=o=DOMRootVar__s("--M3_FE_MATRIX_GRAY_VALUE"):(rgb_a=HSL_RGB__o(e,1,.5),t=rgb_a[0]+.5,s=rgb_a[1]+.5,o=rgb_a[2]+.5),r=r.replace("R",t).replace("G",s).replace("B",o)};class DOM_FeColorMatrix{constructor(e,t,s){this._animateID=t||"ca_animate",this._filter_e=document.getElementById(e),this.matrixToDOM(s)}matrix__o(e){return{from_s:`${e.r0} 0 0 0 0    0 ${e.g0} 0 0 0    0 0 ${e.b0} 0 0    0 0 0 1 0`,to_s:`${e.r1} 0 0 0 0    0 ${e.g1} 0 0 0    0 0 ${e.b1} 0 0    0 0 0 1 0`}}begin__s(e,t){let s=void 0!==t?`${t}s;`:"";return void 0!==e&&(s+=`${e}.end`),s}duration__s(e){return`${e.d}s`}animate__o(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","animate");let o,r;return s.setAttribute("id",`${this._animateID}_${e}`),s.setAttribute("attributeType","XML"),s.setAttribute("attributeName","values"),s.setAttribute("dur",this.duration__s(t)),s.setAttribute("repeatCount",1),({from_s:o,to_s:r}=this.matrix__o(t)),s.setAttribute("from",o),s.setAttribute("to",r),s}matrixToDOM(e){const t=e.length-1;for(let s=0;s<=t;++s){const o=this.animate__o(s,e[s]),r=0===s?this.begin__s(`${this._animateID}_${t}`,0):this.begin__s(`${this._animateID}_${s-1}`);o.setAttribute("begin",r),this._filter_e.appendChild(o)}}}class LogScale{constructor(e){this.minpos=e.minpos||0,this.minlval=Math.log(e.minval||1),this.maxlval=Math.log(e.maxval||1e5),this.scale=(this.maxlval-this.minlval)/(e.maxpos-this.minpos)}position__i(e){return this.minpos+(Math.log(e)-this.minlval)/this.scale}}const AreaActive__o=e=>document.getElementById(`ca_area_${e}`),AreaSwap=(e,t)=>{AreaActive__o(e).classList.toggle("ca_area_active"),AreaActive__o(t).classList.toggle("ca_area_active")},AreaSwitch=e=>{const t=null!==document.querySelector(".ca_area_perspective");document.getElementById("ca_content").classList.toggle("ca_content_perspective");const s=document.getElementsByClassName("ca_area"),o=document.getElementsByClassName("ca_area_selector"),r=o.length;for(let e=0;e<r;++e)s.item(e).classList.toggle("ca_area_perspective"),o.item(e).classList.toggle("ca_selector_perspective");t?document.getElementById(e.replace("select_","")).classList.toggle("ca_area_active"):document.querySelector(".ca_area_active").classList.toggle("ca_area_active")},ScrollLevel=e=>{document.getElementById("ca_grad_down_empty").setAttribute("offset",`${e}%`),document.getElementById("ca_grad_down_fill").setAttribute("offset",`${e}%`),e=100-e,document.getElementById("ca_grad_up_empty").setAttribute("offset",`${e}%`),document.getElementById("ca_grad_up_fill").setAttribute("offset",`${e}%`)},ScrollPosition=e=>{const t=document.body.scrollHeight-window.innerHeight||1;ScrollLevel(Math.floor(e/t*100))},ScrollPage=e=>{const t={left:0,top:window.innerHeight*e,behavior:"smooth"};window.scrollBy(t),ScrollPosition(window.pageYOffset)};window.addEventListener("scroll",e=>{ScrollPosition(window.pageYOffset)});const SEARCH_o={tags_a:["ORD","PER","ART","WORK","COL","BIB","WEB","LOC","DATE"],titles_a:["NON SPÉCIFIÉ","NOM DE PERSONNE","NOM D'ARTISTE","ŒUVRE D'ART","COLLECTION","BIBLIOGRAPHIE","TECHNOLOGIE","LOCALISATION","DATE"],need_s:"",tag_n:0,tag_s:"",port_o:null},fromProvider=e=>{const t=e.result;searchFoundToDOM(t?t.length?t:"NOT_FOUND":"RESET"),"RETRIEVE"===e.task_s&&(SEARCH_o.need_s=t[0].need_s,SEARCH_o.tag_s=t[0].tag_s,searchUpdateRequest())};(()=>{const e=new SharedWorker(`${SITE_ROOT_URL}static/scripts/search_w.js`);SEARCH_o.port_o=e.port,SEARCH_o.port_o.onmessageerror=(e=>console.log(`CLIENT ERROR: ${e.message}`)),SEARCH_o.port_o.onmessage=(e=>{fromProvider(e.data)}),SEARCH_o.port_o.start(),SEARCH_o.port_o.postMessage({task_s:"INIT",url_s:`${SITE_ROOT_URL}search.ini`}),SEARCH_o.port_o.postMessage({task_s:"RETRIEVE"})})();const searchFoundToDOM=e=>{const t=document.getElementById("ca_search_list");for(;t.firstChild;)t.removeChild(t.firstChild);let s,o,r,a,n,i,l,_,c,d;if("string"==typeof e){if("RESET"===e)return;return s=document.getElementById("ca_search_result_entry_void"),r=(o=document.importNode(s.content,!0)).querySelectorAll("dt"),a="NOT_FOUND"===e?"Auncun résultat n'a été trouvé. Essayez avec un autre filtre.":"Le terme fourni pour la recherche est invalide!",r[0].textContent=a,void t.appendChild(o)}s=document.getElementById("ca_search_result_entry");let h=-1;for(entry_o in e)++h,n=(o=document.importNode(s.content,!0)).querySelectorAll("div.ca_urlentry"),e[entry_o].visited&&n[0].classList.toggle("ca_urlentry_mark"),i=o.querySelectorAll("dl"),(_=o.querySelectorAll("a"))[0].setAttribute("href",`${SITE_ROOT_URL}${e[entry_o].path_s}.html`),_[0].setAttribute("data-entry",`${h}`),_[0].setAttribute("onclick","searchVisit( this )"),_[0].textContent=e[entry_o].title_s,(l=o.querySelectorAll("dt"))[0].appendChild(_[0]),i[0].appendChild(l[0]),(c=o.querySelectorAll("dd"))[0].textContent=e[entry_o].date_s+" ",(d=document.createElement("em")).textContent=e[entry_o].author_s,c[0].appendChild(d),i[0].appendChild(c[0]),c[1].textContent=e[entry_o].abstract_s,i[0].appendChild(c[1]),n[0].appendChild(i[0]),t.appendChild(n[0])},searchMarkToDOM=()=>{const e=SEARCH_o.need_s;document.querySelectorAll(`mark[data-tag="${SEARCH_o.tag_s}"]`).forEach(t=>{t.innerText.indexOf(e)>-1&&t.classList.toggle("ca_search_entry_mark")})},searchUpdateRequest=()=>{searchMarkToDOM(),searchSetNeedForm();const e=SEARCH_o.tags_a.findIndex(e=>e===SEARCH_o.tag_s);searchSetTagForm(e)},searchSetNeedForm=e=>document.getElementById("ca_form_is_search_needle").value=SEARCH_o.need_s,searchSetTagForm=e=>document.getElementById("ca_form_is_search_tag_input").innerHTML=SEARCH_o.titles_a[e],searchSetTag=e=>{SEARCH_o.tag_n=e,searchSetTagForm(e)},searchVisit=e=>{SEARCH_o.port_o.postMessage({task_s:"VISIT_URL",entry:e.getAttribute("data-entry")});let t=e.parentNode;for(;t&&!t.classList.contains("ca_urlentry");)t=t.parentNode;t.classList.toggle("ca_urlentry_mark")},searchSubmit=()=>{const e=document.getElementById("ca_form_is_search_needle").value.replace(/[^a-zA_Z\d\s&'\-]/gi,"");if(0===e.length)return searchFoundToDOM("BAD_ENTRY");const t=SEARCH_o.tags_a[SEARCH_o.tag_n];SEARCH_o.port_o.postMessage({task_s:"SEARCH",need_s:e,tag_s:t})},searchHistory=e=>SEARCH_o.port_o.postMessage({task_s:e}),searchReset=()=>{searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.need_s="",SEARCH_o.tag_s="",SEARCH_o.port_o.postMessage({task_s:"RESET"})};document.getElementById("ca_form_is_search").addEventListener("click",e=>{let t=e.target.closest("span");if(null!==t){if("ca_form_is_search_exec"===t.id)return searchSubmit();if("ca_form_is_search_previous"===t.id)return searchHistory("PREVIOUS");if("ca_form_is_search_next"===t.id)return searchHistory("NEXT");if("ca_form_is_search_reset"===t.id)return searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.need_s="",SEARCH_o.tag_s="",void SEARCH_o.port_o.postMessage({task_s:"RESET"})}null===(t=e.target.closest(".ca_form_inputbox_label_button"))||"ca_form_is_search_tag"!==t.id||DOMDialog({type_s:"search"})}),document.getElementById("ca_form_is_search_tagSet").addEventListener("click",e=>{const t=e.target.closest(".ca_form_optbox_label");searchSetTag(t.getAttribute("data-index"))});

