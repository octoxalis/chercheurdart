
class KVIdb{constructor(e="kv_db",t="kv_store",s=1){this.idb=null,this.idb_s=e,this.store=t,this.version=s,this.ready=null,this.init()}init(){this.ready=new Promise((e,t)=>{const s=window.indexedDB.open(this.idb_s,this.version);s.onupgradeneeded=(e=>{this.idb=e.target.result,this.idb.createObjectStore(this.store)}),s.onsuccess=(t=>{this.idb=t.target.result,e(t.target.result)}),s.onerror=(e=>t(e.target.error))})}get(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).get(e);o.onsuccess=(e=>t(e.target.result)),o.onerror=s}))}hasKey(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).count(e);o.onsuccess=(e=>t(e.target.result)),o.onerror=s}))}walk(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor();o.onsuccess=(s=>{let o=s.target.result;o?(e(o.key,o.value),o.continue()):t()}),o.onerror=s}))}last(){return this.ready.then(()=>new Promise((e,t)=>{const s=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor(null,"prev");s.onsuccess=(t=>{t.target.result&&e(t.target.result.value)}),s.onerror=t}))}set(e,t){return this.ready.then(()=>new Promise((s,o)=>{const n=this.idb.transaction([this.store],"readwrite").objectStore(this.store).put(t,e);n.onsuccess=s,n.onerror=o}))}update(e,t,s){return this.ready.then(()=>new Promise((o,n)=>{const r=this.idb.transaction([this.store],"readwrite").objectStore(this.store),a=r.get(e);a.onsuccess=(()=>{const i=a.result;i[t]=s;const _=r.put(i,e);_.onsuccess=o,_.onerror=n}),a.onerror=n}))}deleteAll(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store),n=o.openCursor();n.onsuccess=(t=>{let s,n=t.target.result;n&&(s=n.value,e(s)&&o.delete(n.key),n.continue())}),n.onerror=s}))}delete(e){return this.ready.then(()=>new Promise((t,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store).delete(e);o.onsuccess=t,o.onerror=s}))}clear(){return this.ready.then(()=>new Promise((e,t)=>{const s=this.idb.transaction([this.store],"readwrite").objectStore(this.store).clear();s.onsuccess=e,s.onerror=t}))}deleteIDB(){window.indexedDB.deleteDatabase(this.idb_s)}}const CONST_o={PI2_n:2*Math.PI,RADDEG_n:180/Math.PI,SEPARATOR_s:"▫",STYLE_INDEX_s:"ca_style_index",TEMPLATES_LOAD_s:"ca_templates_load_after",STATUS_SETUP_s:"ca_status_setup",CONDUCTOR_STATUS_s:"ca_form_checkbox_is_conductor",CONDUCTOR_PARTS_s:"ca_form_is_conductor_parts_set",CONDUCTOR_STEPS_s:"ca_conductor_steps",ANNOTATIONS_URL_s:"https://hypothes.is/embed.js",ANNOTATIONS_STATUS_s:"ca_form_checkbox_is_annotations",ANNOTATIONS_SETUP_s:"ca_annotations_setup",IDB_STATUS_s:"Status",IDB_STATUS_M_s:"status"},A_unshift=(e,t)=>{let s=e.length;for(;s;)e[s]=e[s-1],--s;e[0]=t},A_splice=(e,t)=>{let s=e.length;if(s){for(;t<s;)e[t]=e[t+1],++t;--e.length}},A_indexOf__i=(e,t)=>{for(let s=0,o=e.length;s!=o;s++)if(e[s]===t)return s;return-1},A_lastIndexOf__i=(e,t)=>{let s=e.length;for(;s--&&e[s]!==t;);return s},A_fill__a=(e,t)=>{const s=new Array(e);for(;--e>=0;)s[e]=t;return s},dateAsLocale__o=(e=null)=>{let t=e?new Date(e):new Date;const s=t.getFullYear(),o=t.getMonth()+1,n=o<10?`0${o}`:`${o}`,r=t.getDate();return{now_s:`${s}-${n}-${r<10?`0${r}`:`${r}`}`,locale_s:t.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}},cyrb53__i=(e,t=0)=>{let s,o=3735928559^t,n=1103547991^t;for(let t=0;t<e.length;++t)s=e.charCodeAt(t),o=Math.imul(o^s,2654435761),n=Math.imul(n^s,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&(n=Math.imul(n^n>>>16,2246822507)^Math.imul(o^o>>>13,3266489909)))+(o>>>0)},DOMcreateFragment__e=e=>{const t=document.createDocumentFragment(),s=document.createElement("div");for(s.innerHTML=e;s.firstChild;)t.appendChild(s.firstChild);return t},DOMloadHTML=(e,t,s)=>{const o=document.getElementById(t);null!==o&&fetch(e).then(e=>e.text()).then(e=>{o.after(DOMcreateFragment__e(e)),s&&s()}).catch(e=>console.log("Failed to fetch page: ",e))},DOMloadAsset=(e,t,s)=>{const o=document.getElementById(t);if(null===o)return;const n=e.substring(e.lastIndexOf(".")+1,e.length);if(""===n)return;let r;switch(n){case"js":(r=document.createElement("script")).src=e,r.async=!0;break;case"css":(r=document.createElement("link")).href=e,r.rel="stylesheet";break;default:return}s&&(r.onload=s),o.after(r)},DOMStyle__s=(e,t)=>{let s=document.getElementById(e);return s?window.getComputedStyle(s).getPropertyValue(t):""},DOMRootVar=(e,t)=>{document.documentElement.style.setProperty(e,t)},DOMRootVar__s=e=>window.getComputedStyle(document.documentElement).getPropertyValue(e)||"",DOMResetNode=e=>{const t=document.getElementById(e);for(;t.firstChild;)t.removeChild(t.firstChild);return t},DOMImgDim__o=e=>{const t=document.getElementById(e);return{width:t.getAttribute("data-src-width"),height:t.getAttribute("data-src-height")}},DOMStrimHTML__s=e=>e.replace(/(<([^>]+)>)/gi,""),DOMOpenFolder=e=>{e.nextElementSibling.classList.toggle("ca_is_open"),e.parentElement.classList.toggle("ca_has_open")},DOMOpenFolderAll=()=>{const e=document.getElementById("ca_folder_opener"),t=e.classList.contains("_ca_folder_opener_");e.classList.toggle("_ca_folder_opener_");const s=document.getElementById("ca_folder_container_inner").querySelectorAll(".ca_fold_content");let o;for(let e of s)if(t){e.classList.remove("ca_has_open"),o=e.querySelectorAll(".ca_fold_content_item");for(let e of o)e.classList.remove("ca_is_open")}else{e.classList.add("ca_has_open"),o=e.querySelectorAll(".ca_fold_content_item");for(let e of o)e.classList.add("ca_is_open")}},DOMDialog=(e,t)=>{const s=e.type_s;if(dialog_e=document.getElementById(`ca_dialog_is_${s}`),t||"function"!=typeof dialog_e.showModal){const t=e.mark_s?DOMStrimHTML__s(e.mark_s):"";return void window.alert(`${e.header_s||""}: ${e.content_s||""} (${t})`)}if(e.header_s&&(document.getElementById(`ca_dialog_header_is_${s}`).innerHTML=e.header_s),e.content_s&&(document.getElementById(`ca_dialog_content_is_${s}`).innerHTML=e.content_s+(e.mark_s?e.mark_s:"")),void 0===e.options_a){const e=document.getElementById(`ca_dialog_options_is_${s}`);e&&e.classList.add("ca_dialog_option_hidden")}else{options_e=document.getElementById(`ca_dialog_options_is_${s}`),options_e.classList.remove("ca_dialog_option_hidden");const t=options_e.querySelectorAll("li");for(let s=0;s<t.length;++s){const o=t[s].classList.contains("ca_dialog_option_hidden");e.options_a[s]?(t[s].innerHTML=e.options_a[s],t[s].classList.remove("ca_dialog_option_hidden"),t[s].addEventListener("click",()=>{e.result=t[s].id,e.callback_f&&e.callback_f(e.result),dialog_e.close(e.result)})):o||t[s].classList.add("ca_dialog_option_hidden")}}const o=e.cancel||"cancelled";document.getElementById(`ca_dialog_close_is_${s}`).addEventListener("click",()=>{dialog_e.close(o)}),dialog_e.addEventListener("close",t=>{e.result=dialog_e.returnValue}),dialog_e.showModal()},DOMToClipboard=e=>{const t=()=>{e.mark_s+=" impossible",DOMDialog(e,!0)};navigator.permissions.query({name:"clipboard-write"}).then(s=>{"granted"!=s.state&&"prompt"!=s.state||navigator.clipboard.writeText(e.content_s).then(()=>{DOMDialog(e)},()=>{t()})}).catch(()=>{t()})},mailtoDialog__s=e=>{const t={type_s:"note",header_s:"Adresse pour contacter l'auteur",content_s:((e,t)=>{const s=e=>String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26);return`${e.replace(/[a-zA-Z]/g,s)}@${t.replace(/[a-zA-Z]/g,s)}`})("nqhcva","purepurheq.neg"),mark_s:"<p><mark>copie dans le presse-papier</mark></p>"};DOMToClipboard(t)},confirmDialog=(e,t)=>{DOMDialog({type_s:"confirm",content_s:e,options_a:["Je renonce","Je confirme"],callback_f:t})};class DragElement{constructor(e,t){this.gapX=0,this.gapY=0,this.offsetX=0,this.offsetY=0,this.atX=0,this.atY=0,this.drag_e=e,this.keep_b=t||!1,this.start()}start(){this.drag_e.onmousedown=(e=>(this.loose_b=!1,this.gapX=e.clientX-this.offsetX,this.gapY=e.clientY-this.offsetY,this.drag_e.addEventListener("mousemove",this,!1),this.drag_e.addEventListener("mouseup",this,!1),!1))}disable(){this.loose_b=!0}handleEvent(e){return!this.loose_b&&("mousemove"===e.type?(this.atX=e.clientX-this.gapX,this.atY=e.clientY-this.gapY,this.offsetX=this.atX,this.offsetY=this.atY,this.drag_e.style.transform=`translate3d(${this.atX}px, ${this.atY}px, 0)`,!1):void("mouseup"===e.type&&(this.keep_b||(this.drag_e.removeEventListener("mousemove",this,!0),this.drag_e.removeEventListener("mouseup",this,!0)),this.loose_b=!0)))}}const RGB_H__i=(e,t,s)=>{const o=Math.min(e,t,s),n=Math.max(e,t,s);if(n===o)return 0;const r=n-o,a=n===e?(t-s)/r+(t<s?6:0):n===t?(s-e)/r+2:(e-t)/r+4;return Math.floor(60*a)},RGB_S__i=(e,t,s)=>{const o=Math.min(e,t,s),n=Math.max(e,t,s),r=n-o;if(!r)return 0;const a=o+n;return a>255?r/(510-n-o):r/a},RGB_L__i=(e,t,s)=>(Math.min(e,t,s)+Math.max(e,t,s))/510,HSL_RGB__o=(e,t,s)=>{let o,n,r;if(0===t)o=n=r=s;else{const a=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<.1666667?e+6*(t-e)*s:s<.5?t:s<.6666667?e+(t-e)*(.6666667-s)*6:e),i=s<.5?s*(1+t):s+t-s*t,_=2*s-i;o=a(_,i,(e/=360)+.3333334),n=a(_,i,e),r=a(_,i,e-.3333334)}return[o,n,r]},HueMatrix__s=e=>{let t,s,o,n=DOMRootVar__s("--M3_FE_MATRIX");return e<0?t=s=o=DOMRootVar__s("--M3_FE_MATRIX_GRAY_VALUE"):(rgb_a=HSL_RGB__o(e,1,.5),t=rgb_a[0]+.5,s=rgb_a[1]+.5,o=rgb_a[2]+.5),n=n.replace("R",t).replace("G",s).replace("B",o)};class DOM_FeColorMatrix{constructor(e,t,s){this._animateID=t||"ca_animate",this._filter_e=document.getElementById(e),this.matrixToDOM(s)}matrix__o(e){return{from_s:`${e.r0} 0 0 0 0    0 ${e.g0} 0 0 0    0 0 ${e.b0} 0 0    0 0 0 1 0`,to_s:`${e.r1} 0 0 0 0    0 ${e.g1} 0 0 0    0 0 ${e.b1} 0 0    0 0 0 1 0`}}begin__s(e,t){let s=void 0!==t?`${t}s;`:"";return void 0!==e&&(s+=`${e}.end`),s}duration__s(e){return`${e.d}s`}animate__o(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","animate");let o,n;return s.setAttribute("id",`${this._animateID}_${e}`),s.setAttribute("attributeType","XML"),s.setAttribute("attributeName","values"),s.setAttribute("dur",this.duration__s(t)),s.setAttribute("repeatCount",1),({from_s:o,to_s:n}=this.matrix__o(t)),s.setAttribute("from",o),s.setAttribute("to",n),s}matrixToDOM(e){const t=e.length-1;for(let s=0;s<=t;++s){const o=this.animate__o(s,e[s]),n=0===s?this.begin__s(`${this._animateID}_${t}`,0):this.begin__s(`${this._animateID}_${s-1}`);o.setAttribute("begin",n),this._filter_e.appendChild(o)}}}class LogScale{constructor(e){this.minpos=e.minpos||0,this.minlval=Math.log(e.minval||1),this.maxlval=Math.log(e.maxval||1e5),this.scale=(this.maxlval-this.minlval)/(e.maxpos-this.minpos)}position__i(e){return this.minpos+(Math.log(e)-this.minlval)/this.scale}}const AreaActive__e=e=>document.getElementById(`ca_area_${e}`),AreaActive__s=()=>document.querySelector('div[class~="ca_area_active"]').id.replace("ca_area_",""),AreaSwap=(e,t)=>{AreaActive__e(e).classList.toggle("ca_area_active"),AreaActive__e(t).classList.toggle("ca_area_active")},AreaSwap__s=e=>{const t=AreaActive__s();return AreaSwap(t,e),t},AreaSwitch=e=>{const t=null!==document.querySelector(".ca_area_perspective");document.getElementById("ca_content").classList.toggle("ca_content_perspective");const s=document.getElementsByClassName("ca_area"),o=document.getElementsByClassName("ca_area_selector"),n=o.length;for(let e=0;e<n;++e)s.item(e).classList.toggle("ca_area_perspective"),o.item(e).classList.toggle("ca_selector_perspective");t?document.getElementById(e.replace("select_","")).classList.toggle("ca_area_active"):document.querySelector(".ca_area_active").classList.toggle("ca_area_active")},ScrollLevel=e=>{document.getElementById("ca_grad_down_empty").setAttribute("offset",`${e}%`),document.getElementById("ca_grad_down_fill").setAttribute("offset",`${e}%`),e=100-e,document.getElementById("ca_grad_up_empty").setAttribute("offset",`${e}%`),document.getElementById("ca_grad_up_fill").setAttribute("offset",`${e}%`)},ScrollPosition=e=>{const t=document.body.scrollHeight-window.innerHeight||1;ScrollLevel(Math.floor(e/t*100))},ScrollPage=e=>{const t={left:0,top:window.innerHeight*e,behavior:"smooth"};window.scrollBy(t),ScrollPosition(window.pageYOffset)};window.addEventListener("scroll",e=>{ScrollPosition(window.pageYOffset)});const SEARCH_o={TAGS_a:["ORD","PER","ART","WORK","COL","BIB","WEB","LOC","DATE"],TITLES_a:["NON SPÉCIFIÉ","NOM DE PERSONNE","NOM D'ARTISTE","ŒUVRE D'ART","COLLECTION","BIBLIOGRAPHIE","TECHNOLOGIE","LOCALISATION","DATE"],NEED_s:"",TAG_n:0,TAG_s:"",PORT_o:null},fromProvider=e=>{const t=e.result;searchFoundToDOM(t?t.length?t:"NOT_FOUND":"RESET"),"RETRIEVE"===e.task_s&&(SEARCH_o.NEED_s=t[0].need_s,SEARCH_o.TAG_s=t[0].tag_s,searchUpdateRequest())};(()=>{const e=new SharedWorker(`${SITE_URL}static/scripts/search_w.js`);SEARCH_o.PORT_o=e.port,SEARCH_o.PORT_o.onmessageerror=(e=>console.log(`CLIENT ERROR: ${e.message}`)),SEARCH_o.PORT_o.onmessage=(e=>{fromProvider(e.data)}),SEARCH_o.PORT_o.start(),SEARCH_o.PORT_o.postMessage({task_s:"INIT",url_s:`${SITE_URL}search.ini`}),SEARCH_o.PORT_o.postMessage({task_s:"RETRIEVE"})})();const searchFoundToDOM=e=>{const t=document.getElementById("ca_search_list");for(;t.firstChild;)t.removeChild(t.firstChild);let s,o,n,r,a,i,_,c,l,d;if("string"==typeof e){if("RESET"===e)return;return s=document.getElementById("ca_search_result_entry_void"),n=(o=document.importNode(s.content,!0)).querySelectorAll("dt"),r="NOT_FOUND"===e?"Auncun résultat n'a été trouvé. Essayez avec un autre filtre.":"Le terme fourni pour la recherche est invalide!",n[0].textContent=r,void t.appendChild(o)}s=document.getElementById("ca_search_result_entry");let h=-1;for(entry_o in e)++h,a=(o=document.importNode(s.content,!0)).querySelectorAll("div.ca_urlentry"),e[entry_o].visited&&a[0].classList.toggle("ca_urlentry_mark"),i=o.querySelectorAll("dl"),(c=o.querySelectorAll("a"))[0].setAttribute("href",`${SITE_URL}${e[entry_o].path_s}.html`),c[0].setAttribute("data-entry",`${h}`),c[0].setAttribute("onclick","searchVisit( this )"),c[0].textContent=e[entry_o].title_s,(_=o.querySelectorAll("dt"))[0].appendChild(c[0]),i[0].appendChild(_[0]),(l=o.querySelectorAll("dd"))[0].textContent=`${e[entry_o].date_s} ${CONST_o.SEPARATOR_s} `,(d=document.createElement("em")).textContent=e[entry_o].author_s,l[0].appendChild(d),i[0].appendChild(l[0]),l[1].textContent=e[entry_o].abstract_s,i[0].appendChild(l[1]),a[0].appendChild(i[0]),t.appendChild(a[0])},searchMarkToDOM=()=>{const e=SEARCH_o.NEED_s;document.querySelectorAll(`mark[data-tag="${SEARCH_o.TAG_s}"]`).forEach(t=>{t.innerText.indexOf(e)>-1&&t.classList.toggle("ca_search_entry_mark")})},searchUpdateRequest=()=>{searchMarkToDOM(),searchSetNeedForm();const e=SEARCH_o.TAGS_a.findIndex(e=>e===SEARCH_o.TAG_s);searchSetTagForm(e)},searchSetNeedForm=e=>document.getElementById("ca_form_is_search_needle").value=SEARCH_o.NEED_s,searchSetTagForm=e=>document.getElementById("ca_form_is_search_tag_input").innerHTML=SEARCH_o.TITLES_a[e],searchSetTag=e=>{SEARCH_o.TAG_n=e,searchSetTagForm(e)},searchVisit=e=>{SEARCH_o.PORT_o.postMessage({task_s:"VISIT_URL",entry:e.getAttribute("data-entry")});let t=e.parentNode;for(;t&&!t.classList.contains("ca_urlentry");)t=t.parentNode;t.classList.toggle("ca_urlentry_mark")},searchSubmit=()=>{const e=document.getElementById("ca_form_is_search_needle").value.replace(/[^a-zA_Z\d\s&'\-]/gi,"");if(0===e.length)return searchFoundToDOM("BAD_ENTRY");const t=SEARCH_o.TAGS_a[SEARCH_o.TAG_n];SEARCH_o.PORT_o.postMessage({task_s:"SEARCH",need_s:e,tag_s:t})},searchHistory=e=>SEARCH_o.PORT_o.postMessage({task_s:e}),searchReset=()=>{searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.NEED_s="",SEARCH_o.TAG_s="",SEARCH_o.PORT_o.postMessage({task_s:"RESET"})};document.getElementById("ca_form_is_search").addEventListener("click",e=>{let t=e.target.closest("span");if(null!==t){if("ca_form_is_search_exec"===t.id)return searchSubmit();if("ca_form_is_search_previous"===t.id)return searchHistory("PREVIOUS");if("ca_form_is_search_next"===t.id)return searchHistory("NEXT");if("ca_form_is_search_reset"===t.id)return searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.NEED_s="",SEARCH_o.TAG_s="",void SEARCH_o.PORT_o.postMessage({task_s:"RESET"})}if(null!==(t=e.target.closest(".ca_form_inputbox_label_button"))&&"ca_form_is_search_tag"===t.id)return searchTagsDialog()}),document.getElementById("ca_form_is_search_tags_set").addEventListener("click",e=>{const t=e.target.closest(".ca_form_optbox_label");searchSetTag(t.getAttribute("data-key"))});const searchTagsDialog=()=>{DOMDialog({type_s:"search"})};class Conductor{constructor(e){this.prefix_s=e.prefix_s||"ca_conductor",this.navicon_s=e.navicon_s||"ca_svg_icon",this.conductorWidth_n=e.width_n||500,this.template_e=document.getElementById(`ca_conductor_steps_${e.file_s}`),this.content_e=document.importNode(this.template_e.content,!0),this.steps_n=this.content_e.querySelectorAll("li[data-step]").length,this.at_n=-1,this.callbacks_a=[],this.setNavEvents()}setNavEvents(){document.querySelector(`.${this.prefix_s}_nav`).addEventListener("click",e=>{const t=e.target;if(t){const e=t.closest("div").getAttribute("data-event");e&&this[e]()}})}init(e){const t=e.getAttribute("data-target"),s=document.querySelector(t).getBoundingClientRect();this.top_n=s.top,this.left_n=s.left,this.width_n=s.width,this.height_n=s.height;const o=e.getAttribute("data-clip");if(o){const[e,s,n,r]=o.split(" "),a=document.querySelector(t).getAttribute("data-src-width"),i=this.width_n/a;this.top_n+=i*e,this.left_n+=i*s,this.width_n=i*n,this.offset=.5*this.width_n,this.height_n=i*r}return this.setOverlay(),this}setOverlay(){const e=document.querySelector(`.${this.prefix_s}_overlay`);e.classList.remove("ca_unseen");const t=e.style;t.top=`${this.top_n}px`,t.left=`${this.left_n}px`,t.width=`${this.width_n}px`,t.height=`${this.height_n}px`}setConductor(e){let t,s;return document.querySelector(`.${this.prefix_s}_content`).classList.remove("ca_unseen"),DOMRootVar("--CONDUCTOR_WIDTH",e),DOMRootVar("--CONDUCTOR_TOP",this.top_n+this.height_n),window.innerWidth-this.left_n>e?(t=this.left_n,this.offset&&(t+=this.offset),s=0):(t=this.left_n-(e-this.width_n),this.offset&&(t-=this.offset),s=97),DOMRootVar("--CONDUCTOR_LEFT",t),DOMRootVar("--CONDUCTOR_ARROW_LEFT",s),this}setContent(){let e=this.content_e.cloneNode(!0);const t=e.querySelector(`li[data-step="${this.at_n}"] > div`);DOMResetNode(`${this.prefix_s}_title`).appendChild(t);const s=e.querySelector(`li[data-step="${this.at_n}"] > div`);return DOMResetNode(`${this.prefix_s}_description`).appendChild(s),this}open(){let e=this.content_e.cloneNode(!0);const t=e.querySelector(`li[data-step="${this.at_n}"]`),s=e.querySelector(`li[data-step="${this.at_n}"] > div[data-callback="true"]`);s&&!1===this.callbacks_a.includes(this.at_n)&&(this.callback(s),s.hasAttribute("data-callback-once")&&this.callbacks_a.push(this.at_n)),this.init(t).setContent().setConductor(t.getAttribute("data-width")||this.conductorWidth_n)}callback(e){const t=e.textContent.trimStart().trimEnd();new Function(t)()}close(){["overlay","content","nav_previous","nav_next"].forEach(e=>{document.querySelector(`.${this.prefix_s}_${e}`).classList.add("ca_unseen")}),this.at_n=-1}previous(){this.at_n--,0===this.at_n?(document.querySelector(`.${this.prefix_s}_nav_previous`).classList.add("ca_unseen"),this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen")):this.at_n===this.steps_n-2&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),this.open()}next(){this.at_n!==this.steps_n-1&&(this.at_n++,this.at_n===this.steps_n-1?this.steps_n>1&&(document.querySelector(`.${this.prefix_s}_nav_next`).classList.add("ca_unseen"),document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")):(0===this.at_n&&this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),1===this.at_n&&document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")),this.open())}step__n(){return this.at_n}}const STATUS_o={STATUS_IDB_i:null},onload_Status=()=>{STATUS_o.STATUS_IDB_i=new KVIdb("Status","status"),STATUS_o.STATUS_IDB_i.hasKey("annotations_isOn_b").then(e=>{0===e&&STATUS_o.STATUS_IDB_i.set("annotations_isOn_b",!1)}),STATUS_o.STATUS_IDB_i.hasKey("guide_isOn_b").then(e=>{0===e&&STATUS_o.STATUS_IDB_i.set("guide_isOn_b",!0)}),document.getElementById(CONST_o.CONDUCTOR_STATUS_s).addEventListener("click",e=>{document.getElementById(CONST_o.CONDUCTOR_PARTS_s).classList.toggle("ca_unseen"),STATUS_o.STATUS_IDB_i.get("guide_isOn_b").then(e=>STATUS_o.STATUS_IDB_i.set("guide_isOn_b",!1===e))}),document.getElementById(CONST_o.CONDUCTOR_PARTS_s).addEventListener("click",e=>{e.preventDefault();let t=e.target.closest(".ca_form_optbox_label").getAttribute("data-key");"home"===t&&(t="text"),null!==document.getElementById(`${CONST_o.CONDUCTOR_STEPS_s}_${t}`)?Guide.drive():DOMloadHTML(`${SITE_URL}static/fragments/conductor/${t}.html`,CONST_o.TEMPLATES_LOAD_s,()=>{Guide.leader_i=new Conductor({file_s:t,width_n:500}),Guide.drive()})})},Guide={leader_i:null,drive:()=>{document.getElementById("ca_dialog_is_status").close("cancelled"),-1===Guide.leader_i.step__n()&&Guide.leader_i.next()},launch:()=>{STATUS_o.STATUS_IDB_i.get("guide_isOn_b").then(e=>{!1!==e&&launchDialog(e=>{e&&e.includes("dialog_option_0")?DOMloadHTML(`${SITE_URL}static/fragments/conductor/menu.html`,CONST_o.TEMPLATES_LOAD_s,()=>{AreaSwap__s("menu"),Guide.leader_i=new Conductor({file_s:"menu",width_n:500}),Guide.drive()}):STATUS_o.STATUS_IDB_i.set("guide_isOn_b",!1)})})}},launchDialog=e=>{DOMDialog({type_s:"confirm",header_s:"Guide du site",content_s:'<p class="ca_dialog_content_text">Chercheurd.art met à votre disposition un guide<br>qui vous fera découvrir les divers aspects<br>\n  de son contenu et de ses fonctionnalités.<br><br>\n  Souhaitez-vous suivre le guide?</p>',options_a:["Je vais m'en passer","Je vais le suivre"],callback_f:e})},statusDialog=()=>{DOMDialog({type_s:"status"})};

