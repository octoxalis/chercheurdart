
class KVIdb{constructor(t="kv_db",e="kv_store",s=1){this.idb=null,this.idb_s=t,this.store=e,this.version=s,this.ready=null,this.init()}init(){this.ready=new Promise((t,e)=>{const s=window.indexedDB.open(this.idb_s,this.version);s.onupgradeneeded=(t=>{this.idb=t.target.result,this.idb.createObjectStore(this.store)}),s.onsuccess=(e=>{this.idb=e.target.result,t(e.target.result)}),s.onerror=(t=>e(t.target.error))})}get(t){return this.ready.then(()=>new Promise((e,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).get(t);o.onsuccess=(t=>e(t.target.result)),o.onerror=s}))}walk(t){return this.ready.then(()=>new Promise((e,s)=>{const o=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor();o.onsuccess=(s=>{let o=s.target.result;o?(t(o.key,o.value),o.continue()):e()}),o.onerror=s}))}last(){return this.ready.then(()=>new Promise((t,e)=>{const s=this.idb.transaction([this.store],"readonly").objectStore(this.store).openCursor(null,"prev");s.onsuccess=(e=>{e.target.result&&t(e.target.result.value)}),s.onerror=e}))}set(t,e){return this.ready.then(()=>new Promise((s,o)=>{const n=this.idb.transaction([this.store],"readwrite").objectStore(this.store).put(e,t);n.onsuccess=s,n.onerror=o}))}update(t,e,s){return this.ready.then(()=>new Promise((o,n)=>{const r=this.idb.transaction([this.store],"readwrite").objectStore(this.store),a=r.get(t);a.onsuccess=(()=>{const i=a.result;i[e]=s;const _=r.put(i,t);_.onsuccess=o,_.onerror=n}),a.onerror=n}))}deleteAll(t){return this.ready.then(()=>new Promise((e,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store),n=o.openCursor();n.onsuccess=(e=>{let s,n=e.target.result;n&&(s=n.value,t(s)&&o.delete(n.key),n.continue())}),n.onerror=s}))}delete(t){return this.ready.then(()=>new Promise((e,s)=>{const o=this.idb.transaction([this.store],"readwrite").objectStore(this.store).delete(t);o.onsuccess=e,o.onerror=s}))}clear(){return this.ready.then(()=>new Promise((t,e)=>{const s=this.idb.transaction([this.store],"readwrite").objectStore(this.store).clear();s.onsuccess=t,s.onerror=e}))}deleteIDB(){window.indexedDB.deleteDatabase(this.idb_s)}}const CONST_o={PI2_n:2*Math.PI,RADDEG_n:180/Math.PI,SEPARATOR_s:"▫",STYLE_INDEX_s:"ca_style_index",TEMPLATES_LOAD_s:"ca_templates_load_after",STATUS_SETUP_s:"ca_status_setup",CONDUCTOR_STATUS_s:"ca_form_checkbox_is_conductor",CONDUCTOR_PARTS_s:"ca_form_is_conductor_parts_set",CONDUCTOR_STEPS_s:"ca_conductor_steps",ANNOTATIONS_URL_s:"https://hypothes.is/embed.js",ANNOTATIONS_STATUS_s:"ca_form_checkbox_is_annotations",ANNOTATIONS_SETUP_s:"ca_annotations_setup",IDB_STATUS_s:"Status",IDB_STATUS_M_s:"status"},A_unshift=(t,e)=>{let s=t.length;for(;s;)t[s]=t[s-1],--s;t[0]=e},A_splice=(t,e)=>{let s=t.length;if(s){for(;e<s;)t[e]=t[e+1],++e;--t.length}},A_indexOf__i=(t,e)=>{for(let s=0,o=t.length;s!=o;s++)if(t[s]===e)return s;return-1},A_lastIndexOf__i=(t,e)=>{let s=t.length;for(;s--&&t[s]!==e;);return s},A_fill__a=(t,e)=>{const s=new Array(t);for(;--t>=0;)s[t]=e;return s},dateAsLocale__o=(t=null)=>{let e=t?new Date(t):new Date;const s=e.getFullYear(),o=e.getMonth()+1,n=o<10?`0${o}`:`${o}`,r=e.getDate();return{now_s:`${s}-${n}-${r<10?`0${r}`:`${r}`}`,locale_s:e.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}},cyrb53__i=(t,e=0)=>{let s,o=3735928559^e,n=1103547991^e;for(let e=0;e<t.length;++e)s=t.charCodeAt(e),o=Math.imul(o^s,2654435761),n=Math.imul(n^s,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&(n=Math.imul(n^n>>>16,2246822507)^Math.imul(o^o>>>13,3266489909)))+(o>>>0)},DOMcreateFragment__e=t=>{const e=document.createDocumentFragment(),s=document.createElement("div");for(s.innerHTML=t;s.firstChild;)e.appendChild(s.firstChild);return e},DOMloadHTML=(t,e,s)=>{const o=document.getElementById(e);null!==o&&fetch(t).then(t=>t.text()).then(t=>{o.after(DOMcreateFragment__e(t)),s&&s()}).catch(t=>console.log("Failed to fetch page: ",t))},DOMloadAsset=(t,e,s)=>{const o=document.getElementById(e);if(null===o)return;const n=t.substring(t.lastIndexOf(".")+1,t.length);if(""===n)return;let r;switch(n){case"js":(r=document.createElement("script")).src=t,r.async=!0;break;case"css":(r=document.createElement("link")).href=t,r.rel="stylesheet";break;default:return}s&&(r.onload=s),o.after(r)},DOMStyle__s=(t,e)=>{let s=document.getElementById(t);return s?window.getComputedStyle(s).getPropertyValue(e):""},DOMRootVar=(t,e)=>{document.documentElement.style.setProperty(t,e)},DOMRootVar__s=t=>window.getComputedStyle(document.documentElement).getPropertyValue(t)||"",DOMResetNode=t=>{const e=document.getElementById(t);for(;e.firstChild;)e.removeChild(e.firstChild);return e},DOMImgDim__o=t=>{const e=document.getElementById(t);return{width:e.getAttribute("data-src-width"),height:e.getAttribute("data-src-height")}},DOMStrimHTML__s=t=>t.replace(/(<([^>]+)>)/gi,""),DOMOpenFolder=t=>{t.nextElementSibling.classList.toggle("ca_is_open"),t.parentElement.classList.toggle("ca_has_open")},DOMOpenFolderAll=()=>{const t=document.getElementById("ca_folder_opener"),e=t.classList.contains("_ca_folder_opener_");t.classList.toggle("_ca_folder_opener_");const s=document.getElementById("ca_folder_container_inner").querySelectorAll(".ca_fold_content");let o;for(let t of s)if(e){t.classList.remove("ca_has_open"),o=t.querySelectorAll(".ca_fold_content_item");for(let t of o)t.classList.remove("ca_is_open")}else{t.classList.add("ca_has_open"),o=t.querySelectorAll(".ca_fold_content_item");for(let t of o)t.classList.add("ca_is_open")}},DOMDialog=(t,e)=>{const s=t.type_s;if(dialog_e=document.getElementById(`ca_dialog_is_${s}`),e||"function"!=typeof dialog_e.showModal){const e=t.mark_s?DOMStrimHTML__s(t.mark_s):"";return void window.alert(`${t.header_s||""}: ${t.content_s||""} (${e})`)}if(t.header_s&&(document.getElementById(`ca_dialog_header_is_${s}`).innerHTML=t.header_s),t.content_s&&(document.getElementById(`ca_dialog_content_is_${s}`).innerHTML=t.content_s+(t.mark_s?t.mark_s:"")),void 0===t.options_a){const t=document.getElementById(`ca_dialog_options_is_${s}`);t&&t.classList.add("ca_dialog_option_hidden")}else{options_e=document.getElementById(`ca_dialog_options_is_${s}`),options_e.classList.remove("ca_dialog_option_hidden");const e=options_e.querySelectorAll("li");for(let s=0;s<e.length;++s){const o=e[s].classList.contains("ca_dialog_option_hidden");t.options_a[s]?(e[s].innerHTML=t.options_a[s],e[s].classList.remove("ca_dialog_option_hidden"),e[s].addEventListener("click",()=>{t.result=e[s].id,t.callback_f&&t.callback_f(t.result),dialog_e.close(t.result)})):o||e[s].classList.add("ca_dialog_option_hidden")}}const o=t.cancel||"cancelled";document.getElementById(`ca_dialog_close_is_${s}`).addEventListener("click",()=>{dialog_e.close(o)}),dialog_e.addEventListener("close",e=>{t.result=dialog_e.returnValue}),dialog_e.showModal()},DOMToClipboard=t=>{const e=()=>{t.mark_s+=" impossible",DOMDialog(t,!0)};navigator.permissions.query({name:"clipboard-write"}).then(s=>{"granted"!=s.state&&"prompt"!=s.state||navigator.clipboard.writeText(t.content_s).then(()=>{DOMDialog(t)},()=>{e()})}).catch(()=>{e()})},mailtoDialog__s=t=>{const e={type_s:"note",header_s:"Adresse pour contacter l'auteur",content_s:((t,e)=>{const s=t=>String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26);return`${t.replace(/[a-zA-Z]/g,s)}@${e.replace(/[a-zA-Z]/g,s)}`})("nqhcva","purepurheq.neg"),mark_s:"<p><mark>copie dans le presse-papier</mark></p>"};DOMToClipboard(e)},confirmDialog=(t,e)=>{DOMDialog({type_s:"confirm",content_s:t,options_a:["Je renonce","Je confirme"],callback_f:e})},statusDialog=()=>{DOMDialog({type_s:"status"})},conductorDialog=t=>{DOMDialog({type_s:"conductor",options_a:["Je renonce","Commencer"],callback_f:t})},searchTagsDialog=()=>{DOMDialog({type_s:"search"})},contextDialog=t=>{const e={type_s:t};"user_file"===t&&(e.options_a=["Abandonner","Analyser"],e.callback_f=userImgFileToIDB),"user_file_modify"===t&&(e.options_a=["Abandonner","Modifier"],e.callback_f=userGalleryItemUpdate),DOMDialog(e)};class DragElement{constructor(t,e){this.gapX=0,this.gapY=0,this.offsetX=0,this.offsetY=0,this.atX=0,this.atY=0,this.drag_e=t,this.keep_b=e||!1,this.start()}start(){this.drag_e.onmousedown=(t=>(this.loose_b=!1,this.gapX=t.clientX-this.offsetX,this.gapY=t.clientY-this.offsetY,this.drag_e.addEventListener("mousemove",this,!1),this.drag_e.addEventListener("mouseup",this,!1),!1))}disable(){this.loose_b=!0}handleEvent(t){return!this.loose_b&&("mousemove"===t.type?(this.atX=t.clientX-this.gapX,this.atY=t.clientY-this.gapY,this.offsetX=this.atX,this.offsetY=this.atY,this.drag_e.style.transform=`translate3d(${this.atX}px, ${this.atY}px, 0)`,!1):void("mouseup"===t.type&&(this.keep_b||(this.drag_e.removeEventListener("mousemove",this,!0),this.drag_e.removeEventListener("mouseup",this,!0)),this.loose_b=!0)))}}const RGB_H__i=(t,e,s)=>{const o=Math.min(t,e,s),n=Math.max(t,e,s);if(n===o)return 0;const r=n-o,a=n===t?(e-s)/r+(e<s?6:0):n===e?(s-t)/r+2:(t-e)/r+4;return Math.floor(60*a)},RGB_S__i=(t,e,s)=>{const o=Math.min(t,e,s),n=Math.max(t,e,s),r=n-o;if(!r)return 0;const a=o+n;return a>255?r/(510-n-o):r/a},RGB_L__i=(t,e,s)=>(Math.min(t,e,s)+Math.max(t,e,s))/510,HSL_RGB__o=(t,e,s)=>{let o,n,r;if(0===e)o=n=r=s;else{const a=(t,e,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<.1666667?t+6*(e-t)*s:s<.5?e:s<.6666667?t+(e-t)*(.6666667-s)*6:t),i=s<.5?s*(1+e):s+e-s*e,_=2*s-i;o=a(_,i,(t/=360)+.3333334),n=a(_,i,t),r=a(_,i,t-.3333334)}return[o,n,r]},HueMatrix__s=t=>{let e,s,o,n=DOMRootVar__s("--M3_FE_MATRIX");return t<0?e=s=o=DOMRootVar__s("--M3_FE_MATRIX_GRAY_VALUE"):(rgb_a=HSL_RGB__o(t,1,.5),e=rgb_a[0]+.5,s=rgb_a[1]+.5,o=rgb_a[2]+.5),n=n.replace("R",e).replace("G",s).replace("B",o)};class DOM_FeColorMatrix{constructor(t,e,s){this._animateID=e||"ca_animate",this._filter_e=document.getElementById(t),this.matrixToDOM(s)}matrix__o(t){return{from_s:`${t.r0} 0 0 0 0    0 ${t.g0} 0 0 0    0 0 ${t.b0} 0 0    0 0 0 1 0`,to_s:`${t.r1} 0 0 0 0    0 ${t.g1} 0 0 0    0 0 ${t.b1} 0 0    0 0 0 1 0`}}begin__s(t,e){let s=void 0!==e?`${e}s;`:"";return void 0!==t&&(s+=`${t}.end`),s}duration__s(t){return`${t.d}s`}animate__o(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg","animate");let o,n;return s.setAttribute("id",`${this._animateID}_${t}`),s.setAttribute("attributeType","XML"),s.setAttribute("attributeName","values"),s.setAttribute("dur",this.duration__s(e)),s.setAttribute("repeatCount",1),({from_s:o,to_s:n}=this.matrix__o(e)),s.setAttribute("from",o),s.setAttribute("to",n),s}matrixToDOM(t){const e=t.length-1;for(let s=0;s<=e;++s){const o=this.animate__o(s,t[s]),n=0===s?this.begin__s(`${this._animateID}_${e}`,0):this.begin__s(`${this._animateID}_${s-1}`);o.setAttribute("begin",n),this._filter_e.appendChild(o)}}}class LogScale{constructor(t){this.minpos=t.minpos||0,this.minlval=Math.log(t.minval||1),this.maxlval=Math.log(t.maxval||1e5),this.scale=(this.maxlval-this.minlval)/(t.maxpos-this.minpos)}position__i(t){return this.minpos+(Math.log(t)-this.minlval)/this.scale}}const AreaActive__o=t=>document.getElementById(`ca_area_${t}`),AreaSwap=(t,e)=>{AreaActive__o(t).classList.toggle("ca_area_active"),AreaActive__o(e).classList.toggle("ca_area_active")},AreaSwitch=t=>{const e=null!==document.querySelector(".ca_area_perspective");document.getElementById("ca_content").classList.toggle("ca_content_perspective");const s=document.getElementsByClassName("ca_area"),o=document.getElementsByClassName("ca_area_selector"),n=o.length;for(let t=0;t<n;++t)s.item(t).classList.toggle("ca_area_perspective"),o.item(t).classList.toggle("ca_selector_perspective");e?document.getElementById(t.replace("select_","")).classList.toggle("ca_area_active"):document.querySelector(".ca_area_active").classList.toggle("ca_area_active")},ScrollLevel=t=>{document.getElementById("ca_grad_down_empty").setAttribute("offset",`${t}%`),document.getElementById("ca_grad_down_fill").setAttribute("offset",`${t}%`),t=100-t,document.getElementById("ca_grad_up_empty").setAttribute("offset",`${t}%`),document.getElementById("ca_grad_up_fill").setAttribute("offset",`${t}%`)},ScrollPosition=t=>{const e=document.body.scrollHeight-window.innerHeight||1;ScrollLevel(Math.floor(t/e*100))},ScrollPage=t=>{const e={left:0,top:window.innerHeight*t,behavior:"smooth"};window.scrollBy(e),ScrollPosition(window.pageYOffset)};window.addEventListener("scroll",t=>{ScrollPosition(window.pageYOffset)});const SEARCH_o={TAGS_a:["ORD","PER","ART","WORK","COL","BIB","WEB","LOC","DATE"],TITLES_a:["NON SPÉCIFIÉ","NOM DE PERSONNE","NOM D'ARTISTE","ŒUVRE D'ART","COLLECTION","BIBLIOGRAPHIE","TECHNOLOGIE","LOCALISATION","DATE"],NEED_s:"",TAG_n:0,TAG_s:"",PORT_o:null},fromProvider=t=>{const e=t.result;searchFoundToDOM(e?e.length?e:"NOT_FOUND":"RESET"),"RETRIEVE"===t.task_s&&(SEARCH_o.NEED_s=e[0].need_s,SEARCH_o.TAG_s=e[0].tag_s,searchUpdateRequest())};(()=>{const t=new SharedWorker(`${SITE_URL}static/scripts/search_w.js`);SEARCH_o.PORT_o=t.port,SEARCH_o.PORT_o.onmessageerror=(t=>console.log(`CLIENT ERROR: ${t.message}`)),SEARCH_o.PORT_o.onmessage=(t=>{fromProvider(t.data)}),SEARCH_o.PORT_o.start(),SEARCH_o.PORT_o.postMessage({task_s:"INIT",url_s:`${SITE_URL}search.ini`}),SEARCH_o.PORT_o.postMessage({task_s:"RETRIEVE"})})();const searchFoundToDOM=t=>{const e=document.getElementById("ca_search_list");for(;e.firstChild;)e.removeChild(e.firstChild);let s,o,n,r,a,i,_,c,l,d;if("string"==typeof t){if("RESET"===t)return;return s=document.getElementById("ca_search_result_entry_void"),n=(o=document.importNode(s.content,!0)).querySelectorAll("dt"),r="NOT_FOUND"===t?"Auncun résultat n'a été trouvé. Essayez avec un autre filtre.":"Le terme fourni pour la recherche est invalide!",n[0].textContent=r,void e.appendChild(o)}s=document.getElementById("ca_search_result_entry");let h=-1;for(entry_o in t)++h,a=(o=document.importNode(s.content,!0)).querySelectorAll("div.ca_urlentry"),t[entry_o].visited&&a[0].classList.toggle("ca_urlentry_mark"),i=o.querySelectorAll("dl"),(c=o.querySelectorAll("a"))[0].setAttribute("href",`${SITE_URL}${t[entry_o].path_s}.html`),c[0].setAttribute("data-entry",`${h}`),c[0].setAttribute("onclick","searchVisit( this )"),c[0].textContent=t[entry_o].title_s,(_=o.querySelectorAll("dt"))[0].appendChild(c[0]),i[0].appendChild(_[0]),(l=o.querySelectorAll("dd"))[0].textContent=`${t[entry_o].date_s} ${CONST_o.SEPARATOR_s} `,(d=document.createElement("em")).textContent=t[entry_o].author_s,l[0].appendChild(d),i[0].appendChild(l[0]),l[1].textContent=t[entry_o].abstract_s,i[0].appendChild(l[1]),a[0].appendChild(i[0]),e.appendChild(a[0])},searchMarkToDOM=()=>{const t=SEARCH_o.NEED_s;document.querySelectorAll(`mark[data-tag="${SEARCH_o.TAG_s}"]`).forEach(e=>{e.innerText.indexOf(t)>-1&&e.classList.toggle("ca_search_entry_mark")})},searchUpdateRequest=()=>{searchMarkToDOM(),searchSetNeedForm();const t=SEARCH_o.TAGS_a.findIndex(t=>t===SEARCH_o.TAG_s);searchSetTagForm(t)},searchSetNeedForm=t=>document.getElementById("ca_form_is_search_needle").value=SEARCH_o.NEED_s,searchSetTagForm=t=>document.getElementById("ca_form_is_search_tag_input").innerHTML=SEARCH_o.TITLES_a[t],searchSetTag=t=>{SEARCH_o.TAG_n=t,searchSetTagForm(t)},searchVisit=t=>{SEARCH_o.PORT_o.postMessage({task_s:"VISIT_URL",entry:t.getAttribute("data-entry")});let e=t.parentNode;for(;e&&!e.classList.contains("ca_urlentry");)e=e.parentNode;e.classList.toggle("ca_urlentry_mark")},searchSubmit=()=>{const t=document.getElementById("ca_form_is_search_needle").value.replace(/[^a-zA_Z\d\s&'\-]/gi,"");if(0===t.length)return searchFoundToDOM("BAD_ENTRY");const e=SEARCH_o.TAGS_a[SEARCH_o.TAG_n];SEARCH_o.PORT_o.postMessage({task_s:"SEARCH",need_s:t,tag_s:e})},searchHistory=t=>SEARCH_o.PORT_o.postMessage({task_s:t}),searchReset=()=>{searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.NEED_s="",SEARCH_o.TAG_s="",SEARCH_o.PORT_o.postMessage({task_s:"RESET"})};document.getElementById("ca_form_is_search").addEventListener("click",t=>{let e=t.target.closest("span");if(null!==e){if("ca_form_is_search_exec"===e.id)return searchSubmit();if("ca_form_is_search_previous"===e.id)return searchHistory("PREVIOUS");if("ca_form_is_search_next"===e.id)return searchHistory("NEXT");if("ca_form_is_search_reset"===e.id)return searchMarkToDOM(),searchFoundToDOM("RESET"),SEARCH_o.NEED_s="",SEARCH_o.TAG_s="",void SEARCH_o.PORT_o.postMessage({task_s:"RESET"})}null===(e=t.target.closest(".ca_form_inputbox_label_button"))||"ca_form_is_search_tag"!==e.id||DOMDialog({type_s:"search"})}),document.getElementById("ca_form_is_search_tags_set").addEventListener("click",t=>{const e=t.target.closest(".ca_form_optbox_label");searchSetTag(e.getAttribute("data-key"))});class Conductor{constructor(t){this.prefix_s=t.prefix_s||"ca_conductor",this.navicon_s=t.navicon_s||"ca_svg_icon",this.conductorWidth_n=t.width_n||500,this.template_e=document.getElementById(`ca_conductor_steps_${t.file_s}`),this.content_e=document.importNode(this.template_e.content,!0),this.steps_n=this.content_e.querySelectorAll("li[data-step]").length,this.at_n=-1,this.callbacks_a=[],this.setNavEvents()}setNavEvents(){document.querySelector(`.${this.prefix_s}_nav`).addEventListener("click",t=>{const e=t.target;if(e){const t=e.closest("div").getAttribute("data-event");t&&this[t]()}})}init(t){const e=t.getAttribute("data-target"),s=document.querySelector(e).getBoundingClientRect();this.top_n=s.top,this.left_n=s.left,this.width_n=s.width,this.height_n=s.height;const o=t.getAttribute("data-clip");if(o){const[t,s,n,r]=o.split(" "),a=document.querySelector(e).getAttribute("data-src-width"),i=this.width_n/a;this.top_n+=i*t,this.left_n+=i*s,this.width_n=i*n,this.offset=.5*this.width_n,this.height_n=i*r}return this.setOverlay(),this}setOverlay(){const t=document.querySelector(`.${this.prefix_s}_overlay`);t.classList.remove("ca_unseen");const e=t.style;e.top=`${this.top_n}px`,e.left=`${this.left_n}px`,e.width=`${this.width_n}px`,e.height=`${this.height_n}px`}setConductor(t){let e,s;return document.querySelector(`.${this.prefix_s}_content`).classList.remove("ca_unseen"),DOMRootVar("--CONDUCTOR_WIDTH",t),DOMRootVar("--CONDUCTOR_TOP",this.top_n+this.height_n),window.innerWidth-this.left_n>t?(e=this.left_n,this.offset&&(e+=this.offset),s=0):(e=this.left_n-(t-this.width_n),this.offset&&(e-=this.offset),s=97),DOMRootVar("--CONDUCTOR_LEFT",e),DOMRootVar("--CONDUCTOR_ARROW_LEFT",s),this}setContent(){let t=this.content_e.cloneNode(!0);const e=t.querySelector(`li[data-step="${this.at_n}"] > div`);DOMResetNode(`${this.prefix_s}_title`).appendChild(e);const s=t.querySelector(`li[data-step="${this.at_n}"] > div`);return DOMResetNode(`${this.prefix_s}_description`).appendChild(s),this}open(){let t=this.content_e.cloneNode(!0);const e=t.querySelector(`li[data-step="${this.at_n}"]`),s=t.querySelector(`li[data-step="${this.at_n}"] > div[data-callback="true"]`);s&&!1===this.callbacks_a.includes(this.at_n)&&(this.callback(s),s.hasAttribute("data-callback-once")&&this.callbacks_a.push(this.at_n)),this.init(e).setContent().setConductor(e.getAttribute("data-width")||this.conductorWidth_n)}callback(t){const e=t.textContent.trimStart().trimEnd();new Function(e)()}close(){["overlay","content","nav_previous","nav_next"].forEach(t=>{document.querySelector(`.${this.prefix_s}_${t}`).classList.add("ca_unseen")}),this.at_n=-1}previous(){this.at_n--,0===this.at_n?(document.querySelector(`.${this.prefix_s}_nav_previous`).classList.add("ca_unseen"),this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen")):this.at_n===this.steps_n-2&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),this.open()}next(){this.at_n!==this.steps_n-1&&(this.at_n++,this.at_n===this.steps_n-1?this.steps_n>1&&(document.querySelector(`.${this.prefix_s}_nav_next`).classList.add("ca_unseen"),document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")):(0===this.at_n&&this.steps_n>1&&document.querySelector(`.${this.prefix_s}_nav_next`).classList.remove("ca_unseen"),1===this.at_n&&document.querySelector(`.${this.prefix_s}_nav_previous`).classList.remove("ca_unseen")),this.open())}step__n(){return this.at_n}}const STATUS_o={STATUS_IDB_i:null},onload_Status=()=>{STATUS_o.STATUS_IDB_i=new KVIdb("Status","status"),STATUS_o.STATUS_IDB_i.set("annotations_isOn_b",!1),document.getElementById(CONST_o.CONDUCTOR_STATUS_s).addEventListener("click",t=>{document.getElementById(CONST_o.CONDUCTOR_PARTS_s).classList.toggle("ca_unseen")}),document.getElementById(CONST_o.CONDUCTOR_PARTS_s).addEventListener("click",t=>{t.preventDefault();const e=t.target.closest(".ca_form_optbox_label").getAttribute("data-key");null!==document.getElementById(`${CONST_o.CONDUCTOR_STEPS_s}_${e}`)?Guide.drive():DOMloadHTML(`${SITE_URL}static/fragments/conductor/${e}.html`,CONST_o.TEMPLATES_LOAD_s,()=>{Guide.leader_i=new Conductor({file_s:e,width_n:500}),Guide.drive()})})},Guide={leader_i:null,drive:()=>{document.getElementById("ca_dialog_is_status").close("cancelled"),-1===Guide.leader_i.step__n()&&Guide.leader_i.next()}};

